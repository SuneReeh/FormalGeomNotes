% -*- root: main.tex -*-

\chapter{Finite spectra}\label{ChapterFiniteSpectra}


\todo{Write an introduction for me.}

\todo{still need to talk about closed and open subschemes, their basic properties}

\todo{Do you need to come to grips with ind-coherent sheaves?  Hovey has a paper called \text{Homotopy theory of comodules over a Hopf algebroid} where he defines the stable category of a Hopf algebroid, which is sort of about this perspective --- making $BP_*$ into a compact object in a reasonable category of $BP_* BP$--comodules.}

\todo{Callan wrote something at http://chat.stackexchange.com/transcript/message/28980387\#28980387 which addresses the unicity of the formal group attached to a local number field. I thought I drew an analogy to that somewhere in here, but now I can't find it. I would like to.}


\section{The context of a spectrum}\label{StableContextLecture}
\citeme{Pridham's article \textit{Presenting higher stacks as simplicial schemes} seems like a good reference?  Maybe some Toen things are appropriate?  I don't really know where this simplicial scheme stuff is written down.}

\todo[inline]{I don't think I mention Hopf algebroids during this lecture! This is a miserable oversight that \emph{must} be corrected.  Also, I should mention the cotensor product for Hopf algebroids. Update by d.s.: fixed. My reference was appendix I of Ravenel.  Feel free to delete anything you think is unnecessary for our purposes.  I think some of the homological algebra near the end can be left out.  }

\begin{definition} A \textit{Hopf Algebroid} over a commutative ring $ K$ is a pair $ (A, \Gamma)$ of commutative $ K$-algebras with structure maps such that for any other commutative $ K$-algebra $ B$, the sets $ \text{Hom}(A, B)$ and $ \text{Hom}(\Gamma, B)$ are the objects and morphisms of a groupoid.  The structure maps are

\begin{enumerate}
\item $ \eta_L: A \to \Gamma$ (source)
\item $ \eta_R: A \to \Gamma$ (target)
\item $ \Delta: \Gamma \to \Gamma \otimes_A \Gamma$ (composition)
\item $ \varepsilon: \Gamma \to A$ (identity)
\item $ c: \Gamma \to \Gamma$ (inverse)
\end{enumerate}
\end{definition}

There are some relations among the structure maps that mimics the defining properties of a groupoid.  I won't mention them here but they can be found in Ravenel's green book, appendix I.  A graded Hopf algebroid is \textit{connected} if the left and right sub $ A$-modules generated by $ \Gamma_0$ are both isomorphic to $ A$.  If $ \eta_R = \eta_L$, then $ \Gamma$ is a commutative Hopf algebra over $ A$.

\begin{definition}
A left \textit{$ \Gamma$-comodule} $ M$ is a left $ A$-module $ M$ together with a left $ A$-linear map $ \psi: M \to \Gamma \otimes_A M$ that is both counitary and coassociative.
\end{definition}

From now on, we assume that $ \Gamma$ is flat over $ A$.

\begin{definition}
Let $ M$ be a right $ \Gamma$-comodule, and $ N$ a left $ \Gamma$-comodule.  Their \textit{cotensor product} over $ \Gamma$ is the $ K$-module defined by the exact sequence
$ \displaystyle 0 \rightarrow M \square_{\Gamma} N \rightarrow M \otimes_A N \stackrel{\psi \otimes N - M \otimes \psi}{\longrightarrow} M \otimes_A \Gamma \otimes_A N,$
where $\psi$ are the comodule structure maps for $ M$ and $ N$.
\end{definition}

Notice that if $ M$ is a left comodule, then it can be given the structure of a right comodule by the composition
$$ M \stackrel{\psi}{\longrightarrow} \Gamma \otimes M \stackrel{T}{\longrightarrow} M \otimes \Gamma \stackrel{M \otimes c}{\longrightarrow} M \otimes \Gamma,$$
where $ T$ swaps the two factors and $ c$ is the conjugation map.  From this, it is easy to deduce that $ M \square_{\Gamma}N = N \square_{\Gamma} M$.  The following lemma relates cotensor products to Hom.

\begin{lemma}Let $ M$ and $ N$ be left $ \Gamma$-comodules with $ M$ projective over $ A$.  Then
\begin{enumerate}
\item $ \text{Hom}_A(M,A)$ is a right $ \Gamma$-module.
\item $ \text{Hom}_{\Gamma} (M, N) = \text{Hom}_A (M, A) \square_{\Gamma}N$.  In particular, when $ M = A$, we have $ \text{Hom}_{\Gamma}(A, N) = A \square_{\Gamma}N$.
\end{enumerate}
\end{lemma}
\begin{proof} There exist maps $ \psi_M^*$, $ \psi_N^*: \text{Hom}_A(M, N) \to \text{Hom}_A(M, \Gamma \otimes_A N)$, defined by
$$M \stackrel{\psi_M}{\longrightarrow} \Gamma \otimes M \stackrel{\Gamma \otimes f}{\longrightarrow} \Gamma \otimes_A N,$$
$$ M \stackrel{f}{\longrightarrow} N \stackrel{\psi_N}{\longrightarrow} \Gamma \otimes_A N.$$
Since $ M$ is projective over $ A$, there is a canonical isomorphism

$$\text{Hom}_A (M, A) \otimes_A N \simeq \text{Hom}_A(M, N).$$

When $ N = A$, we obtain the map

$$ \psi_M^*: \text{Hom}_A (M, A) \longrightarrow \text{Hom}_A(M, A) \otimes_A \Gamma.$$

It is easy to check that this map satisfies the coassociativity axiom. \\

For the second part, note that by definition, we have
$$\begin{array}{rll}
\text{Hom}(M, N) &=& \text{ker}(\psi_M^* - \psi_N^*) \subset \text{Hom}_A(M, N),\\
\text{Hom}_A(M, A) \square_{\Gamma} N &=& \text{ker}(\psi_M^* \otimes N - \text{Hom}_A(M, A) \otimes \psi_N).
\end{array}$$

The claim then follows from the following commutative diagram:
$$\begin{tikzcd}
\text{Hom}(M, A) \otimes N \ar[r, "\simeq"] \ar[d, shift left, "\text{Hom}(M \text{,} A) \otimes \psi_N"] \ar[d, shift right, swap, "\psi^*_M \otimes N"] & \text{Hom}_A(M, N) \ar[d, shift left, "\psi_N^*"] \ar[d, shift right, swap, "\psi_M^*"] \\
\text{Hom}(M, A) \otimes \Gamma \otimes N  \ar[r, "\simeq"] & \text{Hom}_A(M, \Gamma \otimes_A N)
\end{tikzcd}$$

\end{proof}

\begin{definition} A \textit{map of Hopf algebroids} $ f: (A, \Gamma) \to (B, \Sigma)$ is a pair of $ K$-algebra maps $ f_1: A \to B, f_2: \Gamma \to \Sigma$ such that $ f_1\varepsilon = \varepsilon f_2$, $ f_2 \eta_R = \eta_R f_1$, $ f_2 \eta_L = \eta_L f_1$, $ f_2 c = cf_2$, and $ \Delta f_2 = (f_2 \otimes f_2) \Delta$.
\end{definition}

Now we will discuss some homological algebra of Hopf algebroids.  It turns out that the category of $ \Gamma$-comodules has enough injectives, and so we can make the following definition:

\begin{definition}
 For left $ \Gamma$-comodules $ M$ and $ N$, $ \text{Ext}_{\Gamma}^i (M, N)$ is the $ i$th right derived functor of $ \text{Hom}_{\Gamma}(M, N)$, regarded as a functor of $ N$.  For $ M$ a right $ \Gamma$-module, $ \text{Cotor}_{\Gamma}^i (M, N)$ is the $ i$th right derived functor of $ M \square_{\Gamma} N$, also regarded as a functor of $ N$.  The corresponding graded groups are denoted $ \text{Ext}_{\Gamma}(M, N)$ and $ \text{Cotor}_{\Gamma}(M, N)$, respectively.
 \end{definition}

The next lemma shows that the resolution can satisfy a weaker condition than being injective.

\begin{lemma}\label{dsLemma7} Let

$$ 0 \rightarrow N \rightarrow R^0 \rightarrow R^1 \rightarrow \cdots$$

be a long exact sequence of left $ \Gamma$-comodules such that $ \text{Cotor}_{\Gamma}^n(M, R^i) = 0$ for all $ n > 0$.  Then $ \text{Cotor}_{\Gamma}(M, N)$ is the cohomology of the complex

$$ \text{Cotor}_{\Gamma}^0 (M, R^0) \stackrel{\delta_0}{\longrightarrow} \text{Cotor}_{\Gamma}^0 (M, R^1) \stackrel{\delta_1}{\longrightarrow} \cdots.$$
\end{lemma}

There are many candidates that satisfy the condition of ~\ref{dsLemma7}.  If $ M$ is a projective $ A$-module and $ N$ is an $ A$-module, then $ \text{Cotor}_{\Gamma}^i (M, \Gamma \otimes_A N) = 0$ for $ i > 0$ and $ \text{Cotor}_{\Gamma}^0 (M, \Gamma \otimes_A N) = M \otimes_A N$.  A relative injective $ \Gamma$-comodule is a direct summand of comodules of the form $ \Gamma \otimes_A N$.

\begin{definition}
 (Cobar Resolution) Let $ M$ be a left $ \Gamma$-comodule.  For a right $ \Gamma$-comodule $ L$ that is projective over $ A$, the cobar complex $ C_{\Gamma}^*(L, M)$ is $ C_{\Gamma}^s(L, M) = L \otimes_A \overline{\Gamma}^{\otimes s} \otimes_A M$ (with the obvious differential).  When $ L = \Gamma$, $ D_{\Gamma}(M) = C_{\Gamma}(\Gamma, M)$ is called the cobar resolution of $ M$.
 \end{definition}

It turns out that $ D_{\Gamma}(M)$ is a resolution of $ M$ by relative injectives, and we have the following proposition:

\begin{proposition}
If $ L$ is projective over $ A$, then $ H(C_{\Gamma}^*(L, M)) = \text{Cotor}_{\Gamma}(L, M)$.  In particular, if $ L = A$, then $ H(C_{\Gamma}^*(A, M)) = \text{Ext}_{\Gamma}(A, M)$.
\end{proposition}
\todo[inline]{end of Hopf algebroid.  Actual class starts}

Today we will make good on our promise, made during our investigation of the unoriented bordism ring, to explain where the Adams spectral sequence comes from.  This story neatly divides into two parts, and the first half is just an investigation of how rich of an algebraic category $\CatOf{C}$ we can find that supports a factorization
\begin{center}
\begin{tikzcd}
\CatOf{Spectra} \arrow{rr}{E_*} \arrow{rd} & & \CatOf{Modules}_{E_*} \\
& \CatOf{C} \arrow{ru}.
\end{tikzcd}
\end{center}
Our answer to this question will come out of considering Grothendieck's framework of descent.  Classically, descent concerns itself with a map $f\co R \to S$ of a rings and an $S$--module $N$, and it asks questions like:
\begin{itemize}
\item When is there an $R$--module $M$ such that $N \cong M \otimes_R S = f^* M$?
\item What extra data can be placed on $N$, called \textit{descent data}, so that the category of descent data for $N$ is equivalent to the category of $R$--modules under the map $f^*$?
\item What conditions can be placed on $f$ so that the category of descent data for any given module is always contractible, called \textit{effectivity}?
\end{itemize}

The essential structure of these answers is easy to guess if we proceed by example, using the few tools available to us.  Suppose that we begin instead with an $R$--module $M$ and we set $N = M \otimes_R S$.  By tensoring up, we have two $R$--algebra maps $S \to S \otimes_R S$, given by including along either factor, and we can further tensor $N$ up to $N \otimes_R S$ or $S \otimes_R N$.  Since $N$ came from the $R$--module $M$, these are canonically isomorphic: \[\phi\co ((f \otimes 1) \circ f)^* M \cong ((1 \otimes f) \circ f)^* M.\]  \todo{The notation $f^*$ confused me briefly: you push-forward modules but pull-back quasicoherent sheaves.} Repeating this process produces more isomorphisms which compose according to the triangle
\begin{center}
\begin{tikzcd}
N \otimes_R S \otimes_R S \arrow["\phi_{13}", "\simeq"']{rr} \arrow["\phi_{12}", "\simeq"']{rd} & & S \otimes_R S \otimes_R N \\
& S \otimes_R N \otimes_R S \arrow["\phi_{23}"', "\simeq"]{ru},
\end{tikzcd}
\end{center}
where $\phi_{ij}$ denotes applying $\phi$ to the $i${\th} and $j${\th} coordinates.\citeme{Allen said he knew a good reference for this descent picture}

\begin{definition}
Let $f\co R \to S$ be a map of rings as above.  An $S$--module $N$ equipped with an isomorphism $S \otimes_R N \cong N \otimes_R S$ of $S \otimes_R S$--modules which causes the above triangle to commute is called a \textit{descent datum} for the map $f$.
\end{definition}

\begin{remark}\label{CanonicalCoring}
There are other ways to view this data.  For example, later on we will revisit it from the categorical perspective of \textit{comonads}.  However, there is another perspective which we have already encountered earlier on: that of the \textit{canonical coalgebra} or \textit{Amitsur complex}.  Associated to the map $f\co R \to S$, we can form the ring $S \otimes_R S$, which supports a map \[S \otimes_R S \simeq S \otimes_R R \otimes_R S \to S \otimes_R S \otimes_R S \simeq (S \otimes_R S) \otimes_S (S \otimes_R S).\]  One can check that descent data on a $S$--module is the same as the data of a coaction against $S \otimes_R S$.  As a first step, notice the similarity of function signatures: \[N \xrightarrow{\psi} N \otimes_S (S \otimes_R S) \simeq N \otimes_R S.\]
\end{remark}

The following theorem is the usual culmination of an initial investigation into descent:
\begin{theorem}[Grothendieck]
If $f\co R \to S$ is faithfully flat, then there is an equivalence of $R$--modules and $S$--modules equipped with descent data.
\end{theorem}
\begin{proof}[Jumping off point]
The basic observation is that $0 \to R \to S \to S \otimes_R S$ is an exact sequence of $R$--modules.  This makes much of the homological algebra involved work out.
\end{proof}

For details and additional context, see Section 4.2.1 of \cite{Vistoli}; the story in the context of Hopf algebroids is also spelled out in detail in \cite{Miller}.  \todo{I added the citation requested above, but make a pass over this since I may have put it in an awkward place - AY.}

In our situation, this hypothesis will essentially never be satisfied, so we will pursue a less dramatic statement of the properties of descent.  To see what kind of theorem one might expect, consider the example of $f\co \Z \to \F_p$, which is neither faithful nor flat.  Then, consider the following list of problems (and their partial solutions):
\begin{itemize}
\item The tensor functor $f^*$ cannot distinguish even between the $\Z$--modules $\Z$ and $\Z/p$.  However, if we use $Lf^*$ and resolve $\Z/p$ as $\Z \xrightarrow{p} \Z$, the complexes $Lf^*(\Z)$ and $Lf^*(\Z/p)$ do look distinct.
\item Once we pass to the derived category, then we are no longer in a situation where we can expect the single cocycle condition from the descent data above to suffice.  Instead, we can form a \text{simplicial scheme}, called the \textit{descent object}, by the formula
\[\sheaf D_{\Z \to \F_p} := \left\{
\begin{tikzcd}[ampersand replacement=\&]
\Spec \F_p \arrow{r} \arrow[leftarrow,shift left=\baselineskip]{r} \arrow[leftarrow,shift right=\baselineskip]{r} \&
\begin{array}{c} \Spec \F_p \\ \times_{\Spec \Z} \\ \Spec \F_p \end{array} \arrow[leftarrow, shift left=(2*\baselineskip)]{r} \arrow[shift left=\baselineskip]{r} \arrow[leftarrow]{r} \arrow[shift right=\baselineskip]{r} \arrow[leftarrow, shift right=(2*\baselineskip)]{r} \&
\begin{array}{c} \Spec \F_p \\ \times_{\Spec \Z} \\ \Spec \F_p \\ \times_{\Spec \Z} \\ \Spec \F_p \end{array} \arrow[leftarrow, shift left=(3*\baselineskip)]{r} \arrow[shift left=(2*\baselineskip)]{r} \arrow[leftarrow, shift left=\baselineskip]{r} \arrow{r} \arrow[leftarrow, shift right=\baselineskip]{r} \arrow[shift right=(2*\baselineskip)]{r} \arrow[leftarrow, shift right=(3*\baselineskip)]{r} \&
\cdots
\end{tikzcd}
\right\}.\]
This is meant to look like the \v{C}ech nerve for the ``cover'' $\Spec \F_p \to \Spec \Z$.
\item Accordingly, we need to update our notion of quasicoherent sheaf to live over a simplicial scheme~\cite[Tag 09VK]{stacks-project}.  Given a simplicial scheme $X$, a sheaf $\sheaf F$ on $X$ will be a sequence of sheaves $\sheaf F[n]$ on $X[n]$ as well as, for each map $\phi: [m] \to [n]$ in the simplicial indexing category inducing a map $X(\phi): X[n] \to X[m]$, a choice of map of sheaves \[\sheaf F(\phi)_* \co \sheaf F[m] \to X(\phi)_* \sheaf F[n].\]  Such a sheaf will be called \textit{quasicoherent} when it is levelwise quasicoherent.
\item Finally, we can characterize the structure a quasicoherent sheaf over $\sheaf D_{\Z \to \F_p}$ receives when it is tensored down from $\Z$.  Such a sheaf enjoys that the adjoint map \[\sheaf F(\phi)^* \co X(\phi)^* \sheaf F[m] \to \sheaf F[n]\] is an isomorphism, and in this case we say that $\sheaf F$ is \textit{Cartesian}.
\end{itemize}

\begin{lemma}\citeme{Hovey's \textit{Morita theory for Hopf algebroids and presheaves of groupoids}.}
Without passing to the derived category, there is an equivalence of categories between Cartesian quasicoherent sheaves on the descent object and quasicoherent sheaves equipped with descent data. \todo{you haven't mentioned quasi. coh. sheaves equipped with descent data.  But I take it that it's obvious from the previous paragraphs that it's the same thing as modules equipped with descent data? A concrete definition about quasi-coherent sheaves equipped with descent data would be nice here - d.s.}\qed
\end{lemma}

The real utility of this framework is that it pulls apart the question of descent into two distinct pieces, summarized in the following theorem:
\begin{theorem}\label{AlgebraicCompletionSituation}
Let $i\co A \to X$ be a closed subscheme, and consider the formal completion
\begin{center}
\begin{tikzcd}
A \arrow{rr}{i} \arrow{rd}{j} & & X \\
& X^\wedge_A. \arrow{ru}{k}
\end{tikzcd}
\end{center}
\todo{You haven't defined $X^\wedge_A$ at this point.}
If $X$ is Noetherian, then $k^*$ is flat as a functor of sheaves, $j^*$ is conservative as a functor in the derived category of sheaves, and there is an equivalence of derived categories of sheaves over $X^\wedge_A$ and sheaves over the descent object $\sheaf D_{A \to X}$.\todo{Surely you're supposed to be saying ``bounded'' sometimes when you talk about the derived category.} \qed
\end{theorem}

\begin{remark}\todo{Is this true? Ha, well, I hope so.}
The usual theorem about faithfully flat descent then follows by using the hypotheses on $i$ to deduce that, e.g., if $i^*$ and $j^*$ are both conservative, then so must $k^*$ be.
\end{remark}

We now transfer what we've learned to the situation of homotopical algebra.  Recalling that spectra are equivalent to $\S$--modules, $\S$ the usual sphere spectrum, then any other ring spectrum comes equipped with a unit map $\eta: \S \to E$ and hence push and pull functors
\begin{align*}
\eta_*\co M & \mapsto M, &
\eta^*\co X & \mapsto E \sm X.
\end{align*}
Correspondingly, to any spectrum $X$ we can define the following cosimplicial spectrum:
\begin{definition}
Let $\sheaf D_E(X)$ be the cosimplicial spectrum determined by the formula
\[\mathcal{D}_E(X) := \left\{
\begin{tikzcd}
\begin{array}{c} E \\ \sm \\ X \end{array} \arrow[leftarrow, shift left=\baselineskip]{r}{\mu} \arrow[shift left=(2*\baselineskip)]{r}{\eta_L} \arrow{r}{\eta_R} &
\begin{array}{c} E \\ \sm \\ E \\ \sm \\ X \end{array} \arrow[shift left=(3*\baselineskip)]{r} \arrow[leftarrow, shift left=(2*\baselineskip)]{r} \arrow[shift left=\baselineskip]{r}{\Delta} \arrow[leftarrow]{r} \arrow[shift right=\baselineskip]{r} &
\begin{array}{c} E \\ \sm \\ E \\ \sm \\ E \\ \sm \\ X \end{array} \arrow[shift left=(4*\baselineskip)]{r} \arrow[leftarrow, shift left=(3*\baselineskip)]{r} \arrow[shift left=(2*\baselineskip)]{r} \arrow[leftarrow, shift left=\baselineskip]{r} \arrow{r} \arrow[leftarrow, shift right=\baselineskip]{r} \arrow[shift right=(2*\baselineskip)]{r} &
\cdots
\end{tikzcd}
\right\}.\]

It is called \textit{the descent object for $X$ from $E$ to $\S$}.
\end{definition}

\begin{lemma}
When $E$ is an $A_\infty$--ring spectrum, the descent object $\sheaf D_E(X)$ can be naturally considered as a cosimplicial object in the $\infty$--category of spectra. \qed \todo{I don't intend to prove this, but maybe we could say some mealy words about why it's true. At worst, we could give reference to the relevant part of Higher Algebra.}
\end{lemma}
\begin{definition}\label{DefnOfNilpCompletionAndASS}
Let $E$ be an $A_\infty$--ring spectrum.  Then $X^\wedge_E := \Tot \sheaf D_E(X)$ is called the \textit{$E$--nilpotent completion of $X$}.  The spectral sequence resulting from the coskeletal filtration is called the \textit{$E$--Adams spectral sequence} (for $X$).
\end{definition}
It is not always the case that $X^\wedge_E$ can be lifted from a cosimplicial object in the homotopy category to a sufficiently structured cosimplicial object that we could take its totalization or homotopy colimit.

In general, it's quite rare that the $E$--nilpotent completion of a spectrum $X$ recovers $X$, but in the nice cases we typically work in, it has been known to happen.  In particular, there is the following theorem:
\begin{lemma}\citeme{Ravenel's \textit{Localizations w/r/t ...} paper}
Let $E$ be a connective $A_\infty$ ring spectrum and let $X$ be any connective spectrum.  Then $X^\wedge_E$ is equivalent to the ``$\pi_0 E$--localization'' of $X$, i.e., for a prime $p$ the spectrum $X^\wedge_E$ is $p$--local if $\pi_0 E$ is $p$--local, it is $p$--complete if $\pi_0 E$ is $p$--torsion, and otherwise it is just $X$. \qed
\end{lemma}
\begin{proof}[Proof sketch]
\todo{You really can just look at the Adams tower...}
\end{proof}

Finally, we can compare the topological situation with the algebraic situation.  To have any hope of applying algebra and algebraic geometry, we must impose some nicety properties.  Here is the first:

\begin{definition}
$E$ satisfies \CH, the \textbf Commutativity \textbf Hypothesis, when $\pi_* E^{\sm j}$ is commutative for all $j \ge 1$.
\end{definition}

\begin{definition}
Suppose that $E$ is a ring spectrum satisfying {\CH}.  We define a simplicial scheme associated to $E$, called its \textit{context}, to be
\begin{align*}
\mathcal{M}_E & := \Spec \pi_* \sheaf D_E(\S) \\
& = \left\{
\begin{tikzcd}[ampersand replacement=\&]
\Spec \pi_* E \arrow{r} \arrow[leftarrow,shift left=\baselineskip]{r} \arrow[leftarrow,shift right=\baselineskip]{r} \&
\Spec \pi_* \left( \begin{array}{c} E \\ \sm \\ E \end{array} \right) \arrow[leftarrow, shift left=(2*\baselineskip)]{r} \arrow[shift left=\baselineskip]{r} \arrow[leftarrow]{r} \arrow[shift right=\baselineskip]{r} \arrow[leftarrow, shift right=(2*\baselineskip)]{r} \&
\Spec \pi_* \left( \begin{array}{c} E \\ \sm \\ E \\ \sm \\ E \end{array} \right) \arrow[leftarrow, shift left=(3*\baselineskip)]{r} \arrow[shift left=(2*\baselineskip)]{r} \arrow[leftarrow, shift left=\baselineskip]{r} \arrow{r} \arrow[leftarrow, shift right=\baselineskip]{r} \arrow[shift right=(2*\baselineskip)]{r} \arrow[leftarrow, shift right=(3*\baselineskip)]{r} \&
\cdots
\end{tikzcd}
\right\}.
\end{align*}

\end{definition}

The context is the wellspring of the algebraic category $\CatOf C$ dreamed of in the introduction to this lecture.

\begin{definition}\label{DefnHomologyFunctorsValuedInSheaves}
For a ring spectrum $E$ satisfying {\CH} and input spectrum $X$, we define the following diagram of abelian groups:
\begin{align*}
\Gamma \context{E}(X) & := \left\{
\begin{tikzcd}[ampersand replacement=\&]
\pi_* \left( \begin{array}{c} E \\ \sm \\ X \end{array} \right) \arrow[leftarrow]{r} \arrow[shift left=(\baselineskip)]{r} \arrow[shift right=(\baselineskip)]{r} \&
\pi_* \left( \begin{array}{c} E \\ \sm \\ E \\ \sm \\ X \end{array} \right) \arrow[shift left=(2*\baselineskip)]{r} \arrow[leftarrow, shift left=(\baselineskip)]{r} \arrow[shift right=(2*\baselineskip)]{r} \arrow[leftarrow, shift right=(\baselineskip)]{r} \arrow{r} \&
\pi_* \left( \begin{array}{c} E \\ \sm \\ E \\ \sm \\ E \\ \sm \\ X \end{array} \right) \arrow[shift left=(3*\baselineskip)]{r} \arrow[leftarrow, shift left=(2*\baselineskip)]{r} \arrow[shift left=\baselineskip]{r} \arrow[leftarrow]{r} \arrow[shift right=\baselineskip]{r} \arrow[leftarrow, shift right=(2*\baselineskip)]{r} \arrow[shift right=(3*\baselineskip)]{r} \&
\cdots
\end{tikzcd}
\right\},
\end{align*}
The $j$\th object is a module for $\sheaf{O}(\context{E}[j])$, and hence determines a quasicoherent sheaf over the scheme $\context{E}[j]$.  Suitably interpreted, the maps of abelian groups determine maps of pushforwards so that $\context{E}(X)$ is a quasicoherent sheaf over the simplicial scheme $\context{E}$.
\end{definition}

There is also a common hypothesis on $E$ that brings us back into the world of coalgebra, down from simplicial schemes.
\begin{definition}
Take $E_* E$ to be an $E_*$--module using the left-unit map.  We will say that $E$ satisfies \FH, the \textbf Flatness \textbf Hypothesis, when the right-unit map $E_* \to E_* E$ is a flat map of $E_*$--modules.\footnote{The essential point of this is that it causes $E_* E \otimes_{E_*} E_* X$ to become a homology theory and $E_* E \otimes_{E_*} E_* X \to (E \sm E)_* X$ to become an isomorphism on a point.  Alternatively, this can be viewed as a degeneration condition on the K\"unneth spectral sequence for $E_* (E \sm E)$.}
\end{definition}

\begin{remark}\label{FHGivesComodules}
The main utility of this is that it obviates us from working through the homological algebra of sheaves over simplicial schemes.  Instead, since {\FH} causes $\context{E}$ to become $1$--truncated, we can refer to \Cref{CanonicalCoring} and simply refer back to the homological algebra of comodules.  In light of the discussion in \Cref{HopfAlgebrasFromFiniteGroups,HF2HomologyIsValuedInAutGaEquivarModules}, we also see an interpretation of these groupoid--valued simplicial schemes: they are valued in sets equipped with an action by $\Spec E_* E$, which acts also on the base $\Spec E_*$.  To denote this ``homotopical quotient'' or ``action groupoid'', we will write \[\Spec E_* \mmod \Spec E_* E.\]  Such affine groupoid--valued schemes are themselves quite tangible: their rings of functions form \textit{Hopf algebroids}, and Cartesian quasicoherent sheaves on the groupoid scheme correspond to comodules for the Hopf algebroid.\citeme{A lot of this could use citation.  Most of it is in Ravenel's appendix or Hovey's paper.}
\end{remark}

\todo{I'm still hazy over these two remarks.  I understand what they are trying to say but I'm feeling hazy on the details.  You should explain it to me sometime - d.s.}

\begin{remark}
This homotopical perspective is quite useful --- for instance, a map of groupoid--schemes which induces on points a natural weak equivalence of groupoids also induces an equivalence of comodule categories.  In fact, the \emph{derived} comodule category depends only upon the stack associated to the groupoid--scheme, which allows still more contexts to be identified.  We won't need this observation in what's to come, though, and it introduces substantial technical distractions.  \textbf{However, we \emph{may} got sloppy and say ``stack'' from time to time.}\todo{The standard Johnson--Wilson chart for $\moduli{fg}^{< d}$ is a standard example of a place where stackiness is actually relevant.  Admit to this here and put a forward reference.}\todo{Could also explain the difference: levelwise sheaves of $0$--types vs sheaves of $\infty$--types.}
\end{remark}

\todo{I think there is a notion of quasicoherent sheaf directly over $\sheaf D_E$ and an interpretation of Cartesian sheaves in that setting.  I think that a different view on {\FH} is that it causes the functor $\pi_*$ to preserve Cartesianness.}

\begin{example}
Most of the homology theories we will discuss have this property.  For an easy example, $H\F_2P$ certainly has this property: there is only one possible algebraic map $\F_2 \to \mathcal A_*$, so {\FH} is necessarily satisfied.  This grants us access to a description of the context for $H\F_2$: \[\context{H\F_2P} = \Spec F_2 \mmod \InternalAut{\G_a}.\]
\end{example}

\begin{example}\label{ContextOfMUPExample}
The context for $MUP$ is considerably more complicated, but Quillen's theorem can be equivalently stated as giving a description of it.  It is isomorphic to the moduli of formal groups: \[\context{MUP} \simeq \moduli{fg} := \moduli{fgl} \mmod \moduli{ps}^{\gpd},\] where $\moduli{ps} = \InternalEnd(\A^1)$ is the moduli of self-maps of the affine line (i.e., of power series) and $\moduli{ps}^{\gpd}$ is the multiplicative subgroup of invertible such maps.
\end{example}

\begin{remark}\citeme{Mike's Talbot talk, which is in the TMF volume.}
If $E$ is a complex-oriented ring spectrum, then the simplicial sheaf $\context{MU}(E)$ has an extra degeneracy, cause the $MU$--based Adams spectral sequence for $E$ to degenerate.  In this sense, the ``stackiness'' of $\context{MU}(E)$ is a measure of the failure of $E$ to be orientable.
\end{remark}

\todo{Say what open, closed, flat maps of simplicial schemes are?}
\todo{Jon thinks that this picture can be instructively recast in terms of the cotangent complex.  I'm not sure how, but it's something to keep in mind for later.}






\section{Fiberwise analysis and chromatic homotopy theory}\label{StructureOfMfgl}

\todo[inline]{Andy Senger correctly points out that ``stalkwise'' is the wrong word to use in all this (if we mean to be working in the Zariski topology, which surely we must).  The stalks are selected by maps from certain local rings; $E_\Gamma$ selects the formal neighborhood of the special point inside of this; and $K_\Gamma$ selects the special point itself.  Is ``fiberwise'' enough of a weasel word to get out of this?}

Our first goal for today is to outline a program for the rest of this Case Study.  Yesterday, we developed a rich target for $E$--homology: sheaves over an algebro-geometric object $\context{E}$.  Furthermore, we have explored in \Cref{ContextOfMUPExample} an identification $\context{MUP} \simeq \moduli{fg}$, where $\moduli{fg}$ is the ``moduli of formal groups''.  Our initial goal for today is to outline a program by which we can leverage this to study $MUP$.  Abstractly, one can hope to study any sheaf, including $\context{MUP}(X)$, by analyzing its stalks.  The main utility of Quillen's theorem is that it gives us access to a concrete model of $\context{MUP}$, so that we can determine where to even look for those stalks.

With this in mind, given a map $f$ in the diagram\todo{The bottom of COCTALOS page 68 has a better interpretation of what picking a formal group law has to do with anything, I think.}
\begin{center}
\begin{tikzcd}
\Spec R \arrow{r}{f} & \moduli{fgl} \arrow[equal]{r} \arrow{d} & \context{MUP}[0] \arrow{d} \arrow[equal]{r} & \Spec MUP_0 \\
& \moduli{fg} \arrow[equal]{r} \arrow[leftarrow]{lu} & \context{MUP},
\end{tikzcd}
\end{center}\todo{please check the P's, 0's, and labels of arrows? I tried to fudge around with it since it looked funny but I want to make sure I didn't mess anything up, AY.}
life would be easiest if the $R$--module determined by $f^* \context{MUP}(X)$ were itself the value of a homology theory $R_0(X) = MUP_0 X \otimes_{MUP_0} R$\todo{should this (and the one later) be $R(X)$ and not $R_0$? For example when $R=MUP_0$}.  After all, the pullback of some arbitrary sheaf along some arbitrary map has no special behavior, but homology functors do have familiar special behaviors which we could hope to exploit.  Generally, this is unreasonable to expect: homology theories are functors which convert cofiber sequences of spectra to long exact sequences of groups, but base--change from $\moduli{fg}$ to $\Spec R$ preserves exact sequences exactly when the diagonal arrow is \textit{flat}.  In that case, this gives the following theorem:

\begin{theorem}[Landweber]\label{LandwebersStackyTheorem}
Given such a diagram where the diagonal arrow is flat, the functor \[R_0(X) := MUP_0(X) \otimes_{MUP_0} R\] is a homology theory.
\end{theorem}

\noindent In the course of proving this theorem, Landweber devised a method to recognize flat maps.  Recall that a map $f$ is flat exactly when for any closed substack $i\co A \to \moduli{fg}$ with ideal sheaf $\mathcal I$ there is an exact sequence \[0 \to f^* \mathcal I \to f^* \mathcal O_{\moduli{fg}} \to f^* i_* \mathcal O_A \to 0.\]  Landweber classified the closed substacks of $\moduli{fg}$, thereby giving a method to check maps for flatness.

This appears to be a moot point, however, as it is unreasonable to expect this idea to apply to computing stalks: the inclusion of a closed substack (and so, in particular, a closed point $\Gamma$) is flat only in highly degenerate cases.  We saw in \Cref{AlgebraicCompletionSituation} that this can be repaired: the inclusion of the formal completion of a closed substack of a Noetherian\footnote{$\moduli{fg}$ is not Noetherian, but we will find that each closed point except $\G_a$ lives in an open substack that happens to be Noetherian.} stack is flat, and so we naturally become interested in the infinitesimal deformation spaces of the closed points $\Gamma$ on $\moduli{fg}$.  If we can analyze those, then Landweber's theorem will produce homology theories called $E_\Gamma$.  Moreover, if we find that these deformation spaces are \emph{smooth}, it will follow that their deformation rings support regular sequences.  In this excellent case, by taking the regular quotient we will be able to recover a \emph{homology theory} $K_\Gamma$ which plays the role of computing the stalk of $\context{MUP}(X)$ at $\Gamma$.\footnote{Incidentally, this program has no content when applied to $\context{H\F_2}$, as $\Spec \F_2$ is simply too small.}

We have thus assembled a task list:
\begin{itemize}
\item Describe the open and closed substacks of $\moduli{fg}$.
\item Describe the geometric points of $\moduli{fg}$.
\item Analyze their infinitesimal deformation spaces.
\end{itemize}
This will occupy us for the next few lectures.  Today, we will embark on this analysis by studying the scheme $\moduli{fgl}$ which naturally covers the stack $\moduli{fg}$.

\begin{definition}
There is an affine scheme $\moduli{fgl}$ classifying formal group laws.  Begin with the scheme classifying all bivariate power series:
\begin{align*}
\Spec \Z[a_{ij} \mid i, j \ge 0] & \leftrightarrow \left\{ \text{bivariate power series} \right\}, \\
f \in \Spec\Z[a_{ij} \mid i, j \ge 0](R) & \leftrightarrow \sum_{i, j \ge 0} f(a_{ij}) x^i y^j.
\end{align*}
Then, set $\moduli{fgl}$ to be the closed subscheme selected by the formal group law axioms in \Cref{FGLDefinition}.
\end{definition}

This presentation of $\moduli{fgl}$ as a subscheme appears to be extremely complicated in that its ideal is generated by many hard-to-describe elements, but $\moduli{fgl}$ itself is actually not complicated at all.  We will prove the following theorem:
\begin{theorem}[{\cite[Th\'eor\`eme II]{Lazard}}]\label{LazardsTheorem}
There is a noncanonical isomorphism \[L_\infty := \sheaf{O}_{\moduli{fgl}} \cong \Z[t_n \mid 1 \le n < \infty]. \qed\]
\end{theorem}

The most important consequence of this is \emph{smoothness}:
\begin{corollary}\label{MfglIsSmooth}
Given a formal group law $\phi$ over a ring $R$ and a surjective ring map $f\co S \to R$, there exists a formal group law $\widetilde \phi$ over $S$ with \[\phi = f^* \widetilde \phi. \qed\]
\end{corollary}

\begin{remark}
One might hope that the filtration\todo{What filtration?} above has an immediate geometric realization.  After all, one can consider the $n${\th} order formal neighborhood $\A^{1, (n)}$ of \Cref{FiniteOrderAffineSpaceDefn}.  The appropriate analogue of \Cref{MapsOfFVarsArePowerSeries} shows that a map \[\A^{1, (n)} \times \A^{1, (n)} \to \A^{1, (n)}\] is represented by a bivariate power series, \emph{modulo the ideal $(x^{n+1}, y^{n+1})$}.  This ideal is distinct from $(x, y)^{n+1}$, and so the source scheme of a formal $n$--bud is not the square of $\A^{1, (n)}$, and a formal $n$--bud does \emph{not} determine a group object on some finite scheme.  This is actually a good thing: there are structure theorems preventing many of these intermediate group structures on finite schemes from existing.\citeme{Akhil is who reminded me of this, back in Berkeley.}
\end{remark}

\todo{There's some hidden text here about $n$--buds, but I don't think we ever care about it.}
% In addition to the Corollary above, we can deduce the following:

% \begin{corollary}[{cf. \Cref{LazardsTheorem}}]\citeme{Lazard??}
% There are elements $t_n \in L$, $0 < n < \infty$, such that
% \begin{align*}
% L_r & \cong \Z[t_1, t_2, \ldots, t_r], &
% L_\infty & \cong \Z[t_1, t_2, \ldots, t_r, \ldots],
% \end{align*}
% and such that $L_r \to L_{r+1}$ is the evident inclusion. \qed
% \end{corollary}

% \begin{corollary}[{\cite[Th\'eor\`eme III]{Lazard}}]
% Given an $r$--bud over $R$, there exists an $(r+1)$--bud extending it. \qed
% \end{corollary}

\begin{proof}[{Proof of \Cref{LazardsTheorem}}]
Let $U = \Z[b_0, b_1, b_2, \ldots] / (b_0 - 1)$ be the universal ring supporting a ``strict'' exponential \[\exp(x) := \sum_{j=0}^\infty b_j x^{j+1}\] with compositional inverse \[\log(x) := \sum_{j=0}^\infty m_j x^{j+1}.\]  They induce a formal group law on $U$ by the formula \[x +_U y = \exp(\log(x) + \log(y)),\] classified by a map $u\co L_\infty \to U$. \todo{Why are you writing $L_\infty$ instead of $\sheaf{O}_{\moduli{fgl}}$?}  Modulo decomposables, this map can be computed as \[u(a_{i(n-i)}) = \binom{n}{i} b_{n-1} \pmod{\text{decomposables}}.\]  Writing $d_n = \gcd\left( \binom{n}{i} \middle| 0 < k < n \right)$, the map $Qu$ on degree $2n$ has image the subgroup generated by $d_{n+1} b_n$.  We write $T_{2n}$ for this subgroup.  Using the splitting of $Qu$ from \Cref{Symmetric2CocycleLemma}.4 below, we use the freeness of $U$ to \emph{choose} an algebra splitting \[U \xrightarrow{v} L_\infty \xrightarrow{u} U.\]  The map $v$ is an isomorphism because $uv$ is injective and because we have checked that $v$ is surjective on indecomposables.\todo{This last sentence was a little quick for me.  For example, I don't think you're ``checking'' that $v$ is surjective but more observing that it is so by construction.}\todo{Do the intermediate rings matter here?}
\end{proof}

\begin{definition}\label{DefinitionSymmetric2Cocycle}
In order to prove the missing \Cref{Symmetric2CocycleLemma}, it will be useful to study the series $+_\phi$ ``up to degree $n$'', i.e., modulo $(x, y)^{n+1}$.  Such a truncated series satisfying the analogues of the formal group law axioms is called a \textit{formal $n$--bud}.  Additionally, a \textit{symmetric $2$--cocycle} is a symmetric polynomial $f(x, y)$ satisfying the equation \[f(x, y) - f(t + x, y) + f(t, x + y) - f(t, x) = 0.\]
\end{definition}

\begin{lemma}[Symmetric $2$--cocycle lemma (Part 1)]\label{Symmetric2CocycleLemma}
The following are equivalent:
\begin{enumerate}
\item Symmetric $2$--cocycles that are homogeneous polynomials of degree $n$ are spanned by \[c_n = \frac{1}{d_n} \cdot ((x + y)^n - x^n - y^n).\]
\item For $F$ is an $r$--bud, the set of $(r+1)$--buds extending $F$ form a torsor under addition for $R_{2n-2} \otimes c_r$.\todo{Things suddenly become graded here --- and you really make use of this.  Explain yourself.}
\item Any homomorphism $(QL)_{2n} \to A$ factors through the map $(QL)_{2n} \to T_{2n}$.
\item There is a canonical splitting $T_{2n} \to (QL)_{2n}$.
\end{enumerate}
\end{lemma}
\begin{proof}[Equivalences]\renewcommand{\qedsymbol}{}
Verifying that Claims 1 and 2 are equivalent is a matter of writing out the purported $(r+1)$--buds and taking their difference. \todo{Do you mean write out a $(r+1)$-bud and applying the associativity axiom?}To see that Claim 2 is equivalent to Claim 3, follow the chain \[\CatOf{Groups}((QL)_{2n}, A) \cong \CatOf{Rings}(\Z \oplus (QL)_{2n}, \Z \oplus \Susp^{2n} A) \cong \CatOf{Rings}(L, \Z \oplus \Susp^{2n} A).\]  This shows that such a homomorphism of groups determines an extension of the $n$--bud $\G_a$ to an $(n+1)$--bud, which takes the form of a $2$--cocycle with coefficients in $A$, and hence factors through $T_{2n}$.  Finally, Claim 4 is the universal case of Claim 3.
\end{proof}

We will prove Claim 1 tomorrow.




\section{The structure of $\moduli{fg}$ I: Distance from $\G_a$}\label{MfgI:Height}

We begin by finishing up our proof of Lazard's theorem (and, specifically, the Symmetric $2$--cocycle Lemma).

\begin{lemma}[{Symmetric $2$--cocycle lemma (Part 2): Claim 1 of \Cref{Symmetric2CocycleLemma}}]\label{CohomologyOfGa}
Symmetric $2$--cocycles that are homogeneous polynomials of degree $n$ are spanned by \[c_n = \frac{1}{d_n} \cdot ((x + y)^n - x^n - y^n).\]
\end{lemma}

\begin{proof}\citeme{This follows Chapter 3 of COCTALOS.}
It suffices to show the Lemma over a finitely generated ring.  In fact, the Lemma is true for $A \oplus B$ if and only if it's true for $A$ and for $B$, so the structure theorem for finitely generated abelian groups reduces to the cases of $\Z$ and $\Z/p^r$.  If $A \subseteq B$ and the Lemma is true for $B$, it's true for $A$, so we can further reduce the $\Z$ case to $\Q$.\todo{Rephrase this in terms of localizations.}  We can also reduce from $\Z/p^r$ to $\Z/p$ using an inductive, Bockstein-style argument.  Hence, we can now freely assume that our ground object is a prime field.

For a formal group scheme $\G$, we can form a simplicial scheme $B\G$ in the usual way:
\[B\G := \left\{
\begin{tikzcd}[ampersand replacement=\&]
\begin{array}{c} * \\ \times \\ * \end{array} \arrow{r} \arrow[leftarrow,shift left=\baselineskip]{r} \arrow[leftarrow,shift right=\baselineskip]{r} \&
\begin{array}{c} * \\ \times \\ \G \\ \times \\ * \end{array} \arrow[leftarrow, shift left=(2*\baselineskip)]{r} \arrow[shift left=\baselineskip]{r} \arrow[leftarrow]{r} \arrow[shift right=\baselineskip]{r} \arrow[leftarrow, shift right=(2*\baselineskip)]{r} \&
\begin{array}{c} * \\ \times \\ \G \\ \times \\ \G \\ \times \\ *\end{array} \arrow[leftarrow, shift left=(3*\baselineskip)]{r} \arrow[shift left=(2*\baselineskip)]{r} \arrow[leftarrow, shift left=\baselineskip]{r} \arrow{r} \arrow[leftarrow, shift right=\baselineskip]{r} \arrow[shift right=(2*\baselineskip)]{r} \arrow[leftarrow, shift right=(3*\baselineskip)]{r} \&
\cdots
\end{tikzcd}
\right\}.\]
By applying the functor $\InternalHom{FormalGroups}(-, \G_a)(k)$, we get a cosimplicial abelian group, hence a cochain complex, of which we can take the cohomology.  In the case $\G = \G_a$, the $2$--cocycles in this cochain complex are \emph{precisely} the things we've been calling $2$--cocycles\footnote{They aren't obligated to be symmetric, though.}, so we are interested in computing $H^2$.  The first observation in this direction is that $d^1(x^k) = d_k c_k$.  Secondly, one may check that this complex also computes \[\Cotor_{\sheaf O_{\G}^*}(k, k) \cong \Ext_{\sheaf O_{\G}^*}(k, k),\] which we're now going to compute using a more efficient complex.

\begin{itemize}
\item[$\Q$:] There is a resolution \[0 \to \Q[t] \xrightarrow{\cdot t} \Q[t] \to \Q \to 0,\] from which this follows: \[H^* \InternalHom{FormalGroups}(B\G_a, \G_a)(\Q) = \begin{cases} \Q & \text{when $* = 0$}, \\ \Q & \text{when $* = 1$}, \\ 0 & \text{otherwise}. \end{cases}\] This means that every $2$--cocycle is a coboundary, symmetric or not.
\item[$\F_p$:] Again, we switch to working with $\Ext$ over a free divided power algebra.  Such an algebra splits as a tensor of truncated polynomial algebras, and again computing a minimal free resolution results in the calculation \[H^* \InternalHom{FormalGroups}(B\G_a, \G_a)(\F_p) = \Lambda[\alpha_k \mid k \ge 0] \otimes \F_p[\beta_k \mid k \ge 0],\] with $\alpha_k \in \Ext^1$ and $\beta_k \in \Ext^2$.  In fact, $\alpha_k$ is represented by $x^{p^k}$ and $\beta_k$ is represented by $c_{p^k}(x, y)$, and in the case $p = 2$ the exceptional class $\alpha_{k-1}^2$ is represented by $C_{2^k}(x, y)$.\todo{I'm not sure how to do any of these calculations! Ha.}  Since we have representatives for the surviving homology classes and we know where the bounding class lives, it follows that $c_n(x, y)$ and $x^{p^a} y^{p^b}$ give a basis for \emph{all} of the $2$--cocycles.  It's easy to select the symmetric ones, and it agrees with the prediction of the statement of the Lemma.
\end{itemize}
This finally concludes the proof of \Cref{LazardsTheorem}.
\end{proof}

\todo{Also, people seem to say things about the Mischenko logarithm rather than the invariant differential, but I wonder if we should phrase things in those terms.}
\todo[inline]{Section 12 of Neil's FG notes talk about the infinite height subscheme of $\moduli{fgl}$. He compares it to $H_* MO$ and to the Hurewicz image $\pi_* MU \to H_*(MU; \F_p)$.}

Having described the structure of $\moduli{fgl}$, we turn to understanding the quotient stack $\moduli{fg}$.  Earlier, we proved the following theorem:

\begin{theorem}\todo{Be careful about $\star$-isomorphisms versus isomorphisms.}
Let $k$ be any field of characteristic $0$.  Then there is a unique map \[\Spec k \to \moduli{fg}. \qed\]
\end{theorem}
\begin{proof}
This is a rephrasing of \Cref{RationalFGLsHaveLogarithms} in the language of stacks.
\end{proof}

We would like to have a similar classification of the closed points in positive characteristic.  We proved the theorem above by solving a certain differential equation, which necessitated integrating a power series.  Integration is what we expect to fail in positive characteristic.  The following definition tracks \emph{where} it fails:
\begin{definition}
Let $+_\phi$ be a formal group law.  Let $n$ be the largest degree such that there exists a formal power series $\ell$ with \[\ell(x +_\phi y) = \ell(x) + \ell(y) \pmod{(x, y)^{n}},\] \todo{Should that be a $n+1$?} i.e., $\ell$ is a logarithm for the $n$--bud determined by $+_\phi$.  The \textit{$p$--height of $+_\phi$} is defined to be $\log_p(n)$.
\end{definition}

We will show that this definition is well-behaved, in the following sense:
\begin{lemma}\label{FGLHeightIsAnInteger}
Over a field of positive characteristic $p$, the $p$--height of a formal group law is always an integer.  (That is, $n = p^d$ for some natural number $d$.)
\end{lemma}
\noindent We will have to develop some machinery to get there.  First, notice that this definition of height really depends on the formal group rather than the formal group law.

\begin{lemma}
The height of a formal group law is an isomorphism invariant, i.e., it descends to a function on $\moduli{fg}$.
\end{lemma}
\begin{proof}
The series $\ell$ is a partial logarithm for the formal group law $\phi$, i.e., an isomorphism between the formal group defined by $\phi$ and the additive group.  Since isomorphisms compose, this statement follows.
\end{proof}

With this in mind, we look for a more standard form for formal group laws, where \Cref{FGLHeightIsAnInteger} will hopefully be obvious.  In light of our goal, the most obvious standard form is as follows:
\begin{definition}\label{DefnpTypicalLog}
Suppose that a formal group law $+_\phi$ does have a logarithm.  We say that $+_\phi$ has a \textit{$p$--typical logarithm} in the case that its logarithm has the form \[\log_\phi(x) = \sum_{j=0}^\infty \ell_j x^{p^j}.\]
\end{definition}

\begin{lemma}\label{EveryLogHaspTypification}\citeme{This is due to Hazewinkel}
Every formal group law $+_\phi$ with a logarithm $\log_\phi$ is naturally isomorphic to one whose logarithm is $p$--typical, called the $p$--typification of $+_\phi$.
\end{lemma}
\begin{proof}
Let $\G$ denote the formal group associated to $+_\phi$, and consider its inherited coordinate \[g_0\co \A^1 \xrightarrow{\cong} \G,\] so that \[\log_\phi = \log \circ g_0 = \sum_{n=1}^\infty a_n x^n.\]  Our goal is to perturb this coordinate to a new coordinate $g$ which has the property that it couples with the logarithm \[\A^1 \xrightarrow{g} \G \xrightarrow{\log} \G_a\] to give a power series expansion \[\log(g(x)) = \sum_{n=0}^\infty a_{p^n} x^{p^n}.\]  To do this, we introduce four operators on \emph{curves}:
\begin{itemize}
\item Given $r \in R$, we can define a \textit{homothety} by rescaling the coordinate by $r$: \[\log(g(rx)) = \sum_{n=1}^\infty (a_n r^n) x^n.\]
\item For $\ell \in \Z$, we can define a shift operator (or \textit{Verschiebung}) by \[\log(V_\ell g(x)) = \log(g(x^\ell)) = \sum_{n=1}^\infty a_n x^{n \ell}.\]
\item Given an $\ell \in \Z_{(p)}$, we define the \textit{$\ell$--series} by \[\log([\ell](g(x))) = \ell \log(g(x)) = \sum_{n=1}^\infty \ell a_n x^n.\]
\item For $\ell \in \Z$, we can define a \textit{Frobenius operator} by \[\log(F_\ell g(x)) = \log\left(\sum_{j=1}^\ell{}_{\G} g(\zeta_\ell^j x^{1/\ell}) \right) = \sum_{n=1}^\infty \ell a_{n \ell} x^n,\] where $\zeta_\ell$ is a primitive $\ell${\th} root of unity.  Because this formula is Galois--invariant in choice of primitive root, it actually expands to a series which lies over the ground ring (without requiring an extension by $\zeta_\ell$).  But, by pulling the logarithm through and noting \[\sum_{j=1}^\ell \zeta_\ell^{jn} = \begin{cases}\ell & \text{if $\ell \mid n$}, \\ 0 & \text{otherwise}, \end{cases}\] we can explicitly compute the behavior of $F_\ell$.\footnote{The definition of Frobenius comes from applying the Verschiebung to the character group (or ``Cartier dual'') of $\G$.}
\end{itemize}
Stringing these together, for $p \nmid \ell$ we have \[\log([1/\ell] V_\ell F_\ell g(x)) = \sum_{n=1}^\infty a_{n \ell} x^{n \ell}.\]  Hence, we can consider the curve $g -_{\G} \sum_{p \nmid \ell} [1/\ell] V_\ell F_\ell g$\todo{The sum is taken over all $\ell \in \mathbb{Z}$ not a multiple of $p$, using the formal group addition, right?  In that case, aren't you subtracting too much?  If $n$ is not a power of $p$, then the logarithm of this expression is $a_n$ times $1 -$ the number of factors of $n$ coprime to $p$.  Also, why is this still an isomorphism?} \todo{Some of these $g$s should be $g_0$s.}, which is another coordinate on the same formal group $\G$, but with a $p$--typical logarithm.
\end{proof}

Of course, not every formal group law supports a logarithm --- after all, this is the point of ``height''.  There are two ways around this: one is to pick a surjection $S \to R$ from a torsion-free ring $S$, \emph{choose} a lift of the formal group law to $S$, then pass to $S \otimes \Q$ and study how much of the resulting logarithm descends to $R$.  However, it is not clear that this procedure is independent of choice.  We therefore pursue an alternative approach: an intermediate definition that applies to all formal group laws and which specializes to the one above in the presence of a logarithm.  To do this, we consider what computations are made easier with this sort of formula for a logarithm, and we arrive at the following:

\begin{definition}
The \textit{$p$--series} of a formal group law $+_\phi$ is given by the formula \[[p]_\phi(x) := \overset{\text{$p$ times}}{\overbrace{x +_\phi \cdots +_\phi x}}.\]
\end{definition}

\begin{lemma}
If $+_\phi$ is a formal group law with $p$--typical logarithm, then there are elements $v_n$ with \[[p]_\phi(x) = px +_\phi v_1 x^p +_\phi v_2 x^{p^2} +_\phi \cdots +_\phi v_n x^{p^n} +_\phi \cdots.\]
\end{lemma}
\begin{proof}[Proof sketch]
This comes from comparing the two series
\begin{align*}
\log_\phi(px) & = px + \cdots, \\
\log_\phi([p]_\phi(x)) & = p \log_\phi(x) = px + \cdots.
\end{align*}
The difference is concentrated in degrees of the form $p^d$, beginning in degree $p$, so one can find an element $v_1$ so that \[p \log_\phi(x) - (\log_\phi(px) + \log_\phi(v_1 x^p))\] starts in degree $p^2$, and so on.  In all, this gives the equation
\begin{align*}
p \log_\phi(x) & = \log_\phi (px) + \log_\phi(v_1 x^p) + \log_\phi(v_2 x^{p^2}) + \cdots \\
\intertext{at which point we can use formal properties of the logarithm to deduce}
\log_\phi [p]_\phi(x) & = \log_\phi \left(px +_\phi v_1 x^p +_\phi v_2 x^{p^2} +_\phi \cdots +_\phi v_n x^{p^n} +_\phi \cdots\right) \\
[p]_\phi(x) & = px +_\phi v_1 x^p +_\phi v_2 x^{p^2} +_\phi \cdots +_\phi v_n x^{p^n} +_\phi \cdots \qedhere
\end{align*}
\end{proof}

\begin{definition}
A formal group law is itself said to be \textit{$p$--typical} when its $p$--series has the above form.  (In particular, the logarithm of a $p$--typical formal group law is a $p$--typical logarithm.)
\end{definition}

\begin{corollary}[{\Cref{EveryLogHaspTypification}}]\label{EveryFGLIsPTypical}
Every formal group law is naturally isomorphic to a $p$--typical one.
\end{corollary}
\begin{proof}
The procedure applied to the formal group law $+_\phi$ in the proof of \Cref{EveryLogHaspTypification} applies equally well to an arbitrary formal group law, even without a logarithm --- it just wasn't clear what was being gained.  Now, it is clear\todo{I'm still not sure about this.  Lemma 3.3.7 doesn't say anything about $p$-series, and the previous two lemmas use the existence of a logarithm rather substantially.}: we are gaining the conclusion of this Corollary.
\end{proof}

\begin{remark}\label{EveryPSeriesArises}
There is an inclusion of groupoid--valued sheaves from $p$--typical formal group laws with isomorphisms to all formal group laws with isomorphisms.  \Cref{EveryFGLIsPTypical} can be viewed as presenting this inclusion as a deformation retraction, and in particular the inclusion is a natural \emph{equivalence} of groupoids.  It follows that they both present the same stack: $\moduli{fg}$.  In fact\todo{I don't think we've shown this?  For what it's worth, the statements around Lemma 11.9 and Application 13.10 of COCTALOS prove it.}, the moduli of $p$--typical formal group laws is isomorphic to $\Spec \Z_{(p)}[v_1, v_2, \ldots, v_d, \ldots]$ --- every possible $p$--series is realized by a unique $p$--typical formal group law.
\end{remark}

\begin{remark}\label{RecoverLogarithmRemark}
In fact, the rational logarithm coefficients can be recursively recovered from the coefficients $v_d$, using a similar manipulation:
\begin{align*}
p \log_\phi(x) & = \log_\phi\left([p]_\phi(x)\right) \\
p \sum_{n=0}^\infty m_n x^{p^n} & = \log_\phi \left(\sum_{d=0}^\infty{}_\phi v_d x^{p^d} \right) = \sum_{d=0}^\infty \log_\phi\left(v_d x^{p^d}\right) \\
\sum_{n=0}^\infty p m_n x^{p^n} & = \sum_{d=0}^\infty \sum_{j=0}^\infty m_j v_d^{p^j} x^{p^{d+j}} = \sum_{n=0}^\infty \left( \sum_{k=0}^n m_k v_{n-k}^{p^k} \right) x^{p^n},
\end{align*}
implicitly taking $m_0 = 1$ and $v_0 = p$.
\end{remark}

\begin{proof}[{Proof of \Cref{FGLHeightIsAnInteger}}]
Replace the formal group law by its $p$--typification.  Based on \Cref{RecoverLogarithmRemark}, we see that the height of a $p$--typical formal group law over a field of characteristic $p$ is coincides with the appearance of the first nonzero coefficient in its $p$--series.
\end{proof}

\todo{You could be clearer about the varying assumptions on the ground rings in these different theorems.  Some need to work over $k$, others work over any $\Z_{(p)}$--algebra.}

\section{The structure of $\moduli{fg}$ II: Large scales}

With the notion of ``height'' firmly in hand, we are now in a position to classify the geometric points of $\moduli{fg}$.

\begin{theorem}[{\cite[Th\'eor\`eme IV]{Lazard}}]\label{FGpsOverAlgClosedFields}
Let $\bar k$ be an algebraically closed field of positive characteristic $p$.  There is a bijection between maps \[\Gamma: \Spec \bar k \to \moduli{fg}\] and numbers $1 \le d \le \infty$ given by $\Gamma \mapsto \height(\Gamma)$. \todo{You haven't used the notation $\height(\Gamma)$ before.}
\end{theorem}
\begin{proof}
The easy part of the proof is surjectivity: recalling \Cref{EveryPSeriesArises}, take the $p$--typical formal group law over $\F_p$ determined by the $p$--series $[p]_{\phi_d}(x) = x^{p^d}$, sometimes called the \textit{Honda formal group law}.

To show injectivity, we must show that every $p$--typical formal group law $\phi$ over $\bar k$ is isomorphic to the appropriate Honda group law.  Suppose that the $p$--series for $\phi$ begins \[[p]_\phi(x) = x^{p^d} + a x^{p^{d+k}} + \cdots. \] \todo{These $+$s should be $+_\phi$?} Then, we will construct a coordinate transformation $g(x) = \sum_{j=1}^\infty b_j x^j$ satisfying
\begin{align*}
g(x^{p^d}) & \equiv [p]_\phi(g(x)) & \pmod{x^{p^{d+k} + 1}} \\
\sum_{j=1}^\infty b_j x^{jp^d} & \equiv \sum_{j=1}^\infty b_j^{p^d} x^{jp^d} + \sum_{j=1}^\infty a b_j^{p^{d+k}} x^{jp^{d+k}} & \pmod{x^{p^{d+k} + 1}}.
\end{align*}
For $g$ to be a coordinate transformation, we must have $b_1 = 1$, which in the critical degree $x^{p^{d+k}}$ forces the relation \[b_{p^k} = b_{p^k}^{p^d} + a.\]  Since $\bar k$ is algebraically closed, this relation is solvable, and the coordinate can be perturbed so that the term $x^{p^{d+k}}$ does not appear in the $p$--series.  If we set the earlier terms in the series to be $0$, then we can induct on $d$.
\end{proof}

\begin{remark}\citeme{Remark 11.2 in Neil's FG class notes}
From this, it follows that the ``coarse moduli of formal groups'' --- i.e., the functor from rings to isomorphism classes of formal groups over that ring --- is not representable by a scheme.  The infinitely many isomorphism classes over $\Spec \F_p$ produce infinitely many over $\Spec \Z$ as well.  On the other hand, there is a single $\Q$--valued point of the coarse moduli, whereas the $\Z$--points of a representable functor would inject into its $\Q$--points.
\end{remark}

We now turn to the closed substacks of $\moduli{fg}$, which also admit a reasonable presentation in terms of height.

\begin{lemma}[{\cite[Theorem 4.6]{Wilson}}]
Recall that the moduli scheme of $p$--typical formal group laws is presented as \[\moduli{fgl}^{\ptyp} = \Spec \Z_{(p)}[v_1, v_2, \ldots, v_d, \ldots].\]  Suppose $g(x) = \sum_{j=0}^\infty {}_L t_j x^{p^j}$ is the universal $p$-typical coordinate transformation, which we can use to conjugate the universal group law\todo{What is this universal group law?  Is it the one with $p$-series $px + v_1 x^p + \cdots$?} ``$+_L$'' to a second $p$--typical group law ``$+_R$'', whose $p$--series has the form \[[p]_R(x) = \sum_{d=0}^\infty {}_R \eta_R(v_d) x^{p^d}.\] \todo{What is $\eta_R$? Why does the coefficient of $x^{p^d}$ depend only on $v_d$?} Modulo $p$, there is the relation:
\[\sum_{\substack{i \ge 0 \\ j > 0}}{}_L t_i \eta_R(v_j)^{p^i} \equiv \sum_{\substack{i > 0 \\ j \ge 0}}{}_L v_i t_j^{p^i} \pmod p.\]
\end{lemma}
\begin{proof}[Proof sketch]
Work modulo $p$, one can Freshman's Dream the identity $[p]_L(g(x)) = g([p]_R(x))$ to death.
\end{proof}

\todo{To understand where the $\eta_R$ comes from in the formal below it's the best to mention that the two formal group laws coming from $\eta_L, \eta_R: BP_* \to BP_*BP$ are isomorphic.  And the formula for this isomorphism is the one in the lemma below.  I don't think we've mentioned $BP$ yet, though.  But I guess $\mathcal{M}_{BPP}$ is the moduli of $p$-typical formal group laws mentioned above, so we are very close to introducing $BP$. I have part of this written up about the Hopf algebroid $(BP_*, BP_*BP)$.  I am wary of including it and risk botching up the big picture. -d.s.}

\begin{corollary}[{\cite[Lemmas 4.7-8]{Wilson}}]
Write $I_d$ for the ideal $I_d = (p, v_1, \ldots, v_{d-1})$.  Then \[\eta_R(v_d) \equiv v_d \pmod{I_d}.\]  It follows that the ideals $I_d$ are invariant \todo{Under $\eta_R$?} for all $d$. \qed
\end{corollary}

\noindent What is \emph{much} harder to prove is the following:

\todo{I'm gonna try tidying this proof up a bit. -d.s.}

\begin{theorem}[{\cite[Theorem 4.9]{Wilson}}]
If $I$ is an invariant prime ideal, then $I = I_d$ for some $d$.
\end{theorem}
\begin{proof}[Proof sketch]
Inductively assume that $I_d \subseteq I$.  \todo{How does the base case go?} If this is not an equality, we want to show that $I_{d+1} \subseteq I$ is forced.  Take $y \in I \setminus I_d$; if we could show \[\eta_R(y) = a v_d^j t^K + \cdots, \] \todo{I can't extrapolate this series just from one term, but I'm guessing the rest obviously lives in $I_d$?  Also, what is $a$ and $t$ and why can't they be in $I$ instead of $v_d$?} we could proceed by primality to show that $v_d \in I$ and hence $I_{d+1} \subseteq I$.  This is possible (and, indeed, this is how the proof goes), but it requires serious bookkeeping.
\end{proof}

The equivalent statement in terms of stacks is:

\begin{theorem}[Landweber]\label{LandwebersClassificationOfClosedSubstacks}\citeme{Landweber must have a paper?}
The unique closed substack of $\moduli{fg}{}_{,(p)}:= \moduli{fg} \times \Spec \Z_{(p)}$ of codimension $d$ is selected by $\sheaf O_{\moduli{fgl}^{\ptyp}} / (p, v_1, \ldots, v_{d-1})$. \qed
\end{theorem}

\begin{remark}
The complementary open substack of dimension $d$ is harder to describe.  From first principles, we can say only that it is the locus where the coordinate functions $p$, $v_1$, \ldots, $v_d$ do not \emph{all simultaneously vanish}.  It turns out that:
\begin{enumerate}
\item On a cover, at least one of these coordinates can be taken to be invertible.\todo{This actually uses the Zariski topology on the affine site, and hence may really use stackiness instead of levelwise schemeiness.  This is a problem, since you just told your students that stackiness won't come up...}
\item Once one of them is invertible, a coordinate change on the formal group law can be used to make $v_d$ (and perhaps others in the list) invertible.  Hence, we can use $v_d^{-1} \sheaf O_{\moduli{fg}^{\ptyp}}$ as a coordinate chart.\todo{Hood wanted to know: What, exactly, is required here?}
\item Over a further base extension and a further coordinate change, the higher coefficients $v_{d+k}$ can be taken to be zero.  Hence, we can also use $v_d^{-1} \Z_{(p)}[v_1, \ldots, v_d]$ as a coordinate chart.
\end{enumerate}
\end{remark}

We can now rephrase \Cref{LandwebersStackyTheorem} in terms of algebraic conditions.
\begin{theorem}[{Landweber, cf.\ \Cref{LandwebersStackyTheorem}, see also \cite[Theorem 21.4 and Proposition 21.5]{HopkinsCOCTALOS}}]\citeme{Find Landweber's original paper}
Let $M$ be a module over \[\sheaf O_{\moduli{fg}^{\ptyp}} \cong \Z_{(p)}[v_1, \ldots, v_d, \ldots].\]  If $(p, v_1, \ldots, v_d, \ldots)$ forms an infinite regular sequence on $M$, then \[X \mapsto M \otimes_{\sheaf O_{\moduli{fg}^{\ptyp}}} MU_0(X)\] determines a homology theory \emph{on finite spectra $X$}.  Moreover, if $M/I_d = 0$ for some $d \gg 0$, then the same formula determines a homology theory \emph{on all spectra $X$}.
\end{theorem}
\begin{proof}
This is a direct consequence of the classification of closed substacks of $\moduli{fg}{}_{,(p)}$ in \Cref{LandwebersClassificationOfClosedSubstacks}.  Specifically, $M$ determines a flat quasicoherent sheaf on $\moduli{fg}{}_{,(p)}$ when $\Tor_1(M, N) = 0$ for any other comodule $N$ \todo{Why comodule and not module?  Can you even take $\Tor$ of a module with a comodule?}.  Using the classification of closed substacks and the regularity condition, one can iteratively use the short exact sequences \[0 \to M / I_d \xrightarrow{\cdot v_d} M / I_d \to M / I_{d+1} \to 0\] to trade this condition for the list of conditions
\begin{itemize}
\item $\Tor_1(p^{-1} M, N) = 0$.
\item $\Tor_2(v_1^{-1} M / p, N) = 0$.
\item \ldots
\item $\Tor_d(v_{d-1}^{-1} M / I_{d-1}, N) = 0$.
\item $\Tor_{d+1}(M / I_d, N) = 0$.
\end{itemize}
for any $d$.  \todo{Can you explain this more?  How is the classification of closed substacks used?  Where are these conditions coming from?}If $N$ is coherent, as in the case $N = MU_*(X)$ for a finite spectrum $X$\todo{Is this true? There's some going-around / extension-problem stuff that I've never understood, and it's gotten me in trouble before.}, then this final condition is satisfied automatically for $d \gg 0$.  (Alternatively, we can assume that $M$ eventually satisfies this condition on its own.)  By observing the length of the Koszul resolution associated to the cover $v_d^{-1} \Z_{(p)}[v_1, \ldots, v_d]$, one finally sees that \[\Tor_d(v_{d-1}^{-1} M / I_{d-1}, N) = 0\] is satisfied for \emph{any} quasicoherent sheaf.
\end{proof}

\begin{remark}
It's worth pointing out how strange all of this is. In Euclidean geometry, open subspaces are always top-dimensional, and closed subspaces can drop dimension.  Here, proper open substacks of every dimension appear, and every nonempty closed substack is $\infty$--dimensional (albeit of positive codimension).
\end{remark}








\section{The structure of $\moduli{fg}$ III: Small scales}

\todo{This is the most confusing section in this chapter.}

We now turn to the deformation theory of formal groups, which is about the appearance of formal groups in families.  Specifically, following \Cref{StructureOfMfgl} we will be interested in infinitesimal deformations of formal groups over fields of positive characteristic.

\begin{definition}
Given a formal group $\Gamma$ classified by a map $\Spec k \to \moduli{fg}$, then a \textit{deformation of $\Gamma$ to a scheme $X$} is a factorization \[\Spec k \to X \to \moduli{fg}.\]  If $X$ is a nilpotent thickening of $\Spec k$ (or an ind-system of such), then the deformation is said to be \textit{infinitesimal}.
\end{definition}

The study of all possible infinitesimal deformations of a particular map $\Spec k \to \moduli{fg}$ has a geometric interpretation, embodied by the following Lemma:

\begin{lemma}\todo{Actually, maybe this came up at the beginning of the previous day?}
Let $\Spec k \to Y$ be any map, and let $\Spec k \to X \to Y$ be a factorization through a nilpotent thickening $X$ of $\Spec k$.  Then there is a natural further factorization \[\Spec k \to X \dashrightarrow Y^\wedge_X \to Y. \qed\]
\end{lemma}

\noindent The spirit of the Lemma, then, is that the study of infinitesimal deformations of $\Gamma\co \Spec k \to \moduli{fg}$ is equivalent to the study of $(\moduli{fg})^\wedge_\Gamma$ itself.  So, this fits into our program of analyzing the (local) structure of $\moduli{fg}$.

\begin{example}
It's also helpful to expand what an infinitesimal deformation is in our case of interest.  Set $Y = \moduli{fg}$, and fix a map $\Gamma\co \Spec k \to \moduli{fg}$ classifying a formal group $\Gamma$ over $\Spec k$.  Let $S$ be a local ring with maximal ideal $\m$ so that $S$ is a nilpotent thickening of $S / \m$.  A deformation of $\Gamma$ to $S$ is the data of a formal group $\G$ over $\Spec S$, an identification $i\co \Spec k \to \Spec S/\m$, and a choice of an isomorphism $f$ fitting together into the following diagram:
\begin{center}
\begin{tikzcd}
\Gamma \arrow{rd} \arrow["f", "\simeq"']{r} & i^* j^* \G \arrow{rr} \arrow{d} & & \G \arrow{d} \\
& \Spec k \arrow{r}{i} & \Spec S/\m \arrow{r}{j} & \Spec S.
\end{tikzcd}
\end{center}
\end{example}

\begin{example}
Consider the case of an infinitesimal parameter space $X = \A^1$.  A map $\A^1 \to \moduli{fg}$ can be presented by a map $\A^1 \to \moduli{fgl}$, which corresponds to a ``family'' of formal group laws $+_{\phi_h}$ of the form \[x +_{\phi_h} y = (x +_\phi y) + h(x +_{\phi(1)} y) + h^2(x +_{\phi(2)} y) + \cdots\] for some series $+_{\phi(n)}$.  In particular, $+_{\phi(0)}$ is a formal group law over $k$.
\end{example}

The analysis of $(\moduli{fg})^\wedge_\Gamma$ is due to Lubin and Tate, but we first follow a more structured approach written down by Lazarev.\citeme{Cite both of these}
\begin{definition}\todo{Can this be phrased geometrically?}
Let $+_\phi$ be a formal group law over $R$, and let $M$ be an $R$--module. The deformation complex $\widehat C^*(\phi; M)$ is defined by \[M \to M\ps{x_1} \to M\ps{x_1, x_2} \to M\ps{x_1, x_2, x_3} \to \cdots\] with differential
\begin{align*}
(df)(x_1, \ldots, x_{n+1}) & = \phi_1\left(\sum_{i=1}^n {}_\phi x_i, x_{n+1} \right) \cdot f(x_1, \ldots, x_n) \\
& \quad + \sum (-1)^i f(x_1, \ldots, x_i +_\phi x_{i+1}, \ldots, x_{n+1}) \\
& \quad + (-1)^{n+1} \left( \phi_2\left(x_1, \sum_{i=2}^{n+1} {}_\phi x_i \right) \cdot f(x_2, \ldots, x_{n+1}) \right),
\end{align*}
where we have written
\begin{align*}
\phi_1(x, y) & = \frac{\partial(x +_\phi y)}{\partial x}, &
\phi_2(x, y) & = \frac{\partial(x +_\phi y)}{\partial y}.
\end{align*}
\end{definition}

This complex tracks the data of infinitesimal deformations.  For instance, consider a deformed automorphism $f$ of $+_\phi$, expressed as \[f(x) = f_0(x) + h f_1(x) + h^2 f_2(x) + \cdots,\] and satisfying \[f(x +_\phi y) = f(x) +_\phi f(y).\]  Applying $\left.\frac{\partial}{\partial h}\right|_{h=0}$ to this equality gives \[f_1(x +_\phi y) = \phi_1(x, y)f_1(x) + \phi_2(x, y)f_1(y)\]\todo{Why is this $\phi_1(x,y)$ and not $\phi_1(f_0(x),f_0(y))$? Is it the point that $f(x) \equiv x$ mod $h$?} and thus $f_1$ is a $1$--cocycle in the deformation complex.  A similar sequence of observations culminates in the following theorem:
\begin{theorem}[{\cite[p.\ 1320]{LazarevDeformations}}]
Let $+_\phi$ be a formal group law over a ring $R$ and let $S \to R$ be a square--zero extension with kernel $M$.
\begin{enumerate}
\item Automorphisms of $+_\phi$ over $S$ covering the identity on $R$ correspond to elements in $\widehat Z^1(\phi; M)$.
\item Extensions of $+_\phi$ to $S$ correspond to elements in $\widehat Z^2(\phi; M)$.
\item Two such extensions are isomorphic as formal group laws over $S$ if their cocycles differ by an element in $\widehat B^2(\phi; M)$. \qed
\end{enumerate}
\end{theorem}

So, this complex contains all the information we're interested in.  Miraculously, we actually already studied the main input to computing this complex yesterday:

\begin{lemma}[{\cite[p.\ 1320]{LazarevDeformations}}]
This is quasi-isomorphic to the usual bar complex:
\begin{align*}
\widehat C^*(\phi; M) & \to \CatOf{FormalSchemes}(B\G_\phi, M \otimes \G_a) \\
f & \mapsto \phi_1\left(0, \sum_{i=1}^n{}_\phi x_i \right)^{-1} f(x_1, \ldots, x_n). \qed
\end{align*}
\todo{What is $\G_\phi$?  Also, you stop using $\G_\phi$ below.}
\end{lemma}

Of course, yesterday we computed the specific case of $\G = \G_a$.  However, by filtering the multiplication on $\G$ by degree, we can use this specific calculation to get up to the general one.

\begin{lemma}\label{CalculationOfLTTangentSpace}
Let $\G$ be a formal group of finite height $d$ over a field $k$.  Then the group $H^2(\G; M \otimes \G_a)$ classifying isomorphism classes of deformations is a free $k$--vector space of dimension $(d - 1)$.\todo{$d$ or $(d-1)$?  There's $\beta_0$ through $\beta_{d-1}$...}
\end{lemma}
\begin{proof}[Proof (after Hopkins)]
Using $p$--typification, we select a coordinate on $\G$ of the form \[x +_\phi y = x + y + (\mathrm{unit}) c_{p^d} + \cdots.\]  Then, filter $\G$ by degree and consider the resulting spectral sequence of signature \[H^*(\G_a; M \otimes \G_a) \cong M \otimes (\Lambda_k[\alpha_j \mid j \ge 0] \otimes k[\beta_j \mid j \ge 0]) \Rightarrow H^*(\G; M \otimes \G_a).\]  To compute the differentials in this spectral sequence, one computes by hand the formula for the differential in the bar complex, working up to lowest visible degree.  In order to compute  \[(x +_\phi y)^{p^r} - (x^{p^r} + y^{p^r}) = (\text{unit}) \cdot c_{p^{d + r}}(x, y) + \cdots,\] where we used $c_{p^d}^{p^r} = c_{p^{r+d}}$.  \todo{This last ``sentence'' is missing a few words.  Also, maybe you should remind us what $\alpha_j$ and $\beta_j$ are in terms of $x$ and $y$.} So, we see that there are $d - 1$ things at the bottom of the spectral sequence which are not coboundaries, and we need to check that they are indeed permanent cocycles.  To do this, we need only show that they are realized by deformations, which Lubin and Tate accomplish in \Cref{LubinTateRealizationLemma}.
\end{proof}
\begin{lemma}[{\cite[Proposition 1.1]{LubinTate}}]\label{LubinTateRealizationLemma}
Let $W$ be a local ring with residue field $k$, and let $\phi$ be a group law of height $d$ on $k$.  There is a group law $\tilde\phi$ over $W\ps{u_1, \ldots, u_{d-1}}$ restricting to $\phi$ on $k$ such that for some $j \geq 1$, \[x +_{\tilde \phi} y \equiv x + y + u_j c_{p^j}(x, y) \pmod{u_1, \ldots, u_{j-1}, (x, y)^{p^j+1}}. \qed\]
\end{lemma}

Picking $W = \W_p(k)$ to be the ring of Witt vectors, \Cref{LubinTateRealizationLemma} produces the universal example of a deformation of a group law $\phi$ to $\tilde \phi$.

\begin{theorem}\label{LubinTateDeformationSpace}\citeme{You got this from 7.5.1 of the Crystals notes.}
Let $\Spf R$ be an infinitesimal deformation of its residue field $\Spec k$.  For each lift of $\phi$ to $\psi$ over $\Spf R$, there is a unique homomorphism \[\alpha \in \CatOf{FormalSchemes}(\Spf R, \Spf \W_p(k)\ps{u_1, \ldots, u_{d-1}})\] with $\alpha^* \tilde \phi$ uniquely strictly isomorphic to $\psi$.
\end{theorem}
\begin{proof}
We will prove this inductively on the neighborhoods of $\Spec k = \Spec R / I$ in $\Spf R$.  Suppose that we have demonstrated the Theorem for $\psi_{r-1} = R / I^{r-1} \otimes \psi$, so that there is a map $\alpha_{r-1}\co \W_p(k)\ps{u_1, \ldots, u_{d-1}} \to R/I^{r-1}$ and a strict isomorphism $g_{r-1}\co \psi_{r-1} \to \alpha_{r-1}^* \tilde \phi$.  The exact sequence \[0 \to I^{r-1} / I^r \to R/I^r \to R/I^{r-1} \to 0\] exhibits $R/I^r$ as a square--zero extension of $R/I^{r-1}$ by $M = I^{r-1} / I^r$.\todo{My source material wants $R$ to be Noetherian so that $M$ is finite dimensional.  This is important?}

Let $\beta$ be \emph{any} lift of $\alpha_{r-1}$ and $h$ be \emph{any} lift of $g_{r-1}$ to $R/I^r$, and let $A$ and $B$ be the induced group laws
\begin{align*}
x +_A y & = \beta^* \tilde \phi, &
x +_B y & = h\left( h^{-1}(x) +_{\psi_r} h^{-1}(y) \right).
\end{align*}
Since these both deform the group law $\psi_{r-1}$, by \Cref{CalculationOfLTTangentSpace} there exist $m_j \in M$ and $f(x) \in M\ps{x}$ satisfying \[(x +_B y) - (x +_A y) = (df)(x, y) + \sum_{j=1}^{d-1} m_j v_j(x, y),\] where $v_j(x, y)$ is the $2$--cocycle associated to the cohomology $2$--class $\beta_j$.  The following definitions complete the induction:
\begin{align*}
g_r(x) & = h(x) - f(x), &
\alpha_r(u_j) & = \beta(u_j) + m_j. \qedhere
\end{align*}
\end{proof}

\begin{remark}\label{ActionBySnLiftsToLTn}
Our calculation $H^1(\G_\phi; M \otimes \G_a)$ also shows that there are \emph{no} automorphisms of the formal group $\Gamma$ over the special fiber which induce automorphisms of the universal deformation.  Specifically, \emph{any} deformation of a nontrivial automorphism of $\Gamma$ acts nontrivially on Lubin--Tate space by permuting the deformations living over the various fibers.  A consequence of this observation is that the deformation space produced in \Cref{LubinTateDeformationSpace} is a \emph{formal scheme}, carrying only the previously-known inertial group of $\Aut \Gamma$ at the special fiber, rather than a full-on stack.
\end{remark}

\begin{remark}
We also see that our analysis fails wildly for the case $\Gamma = \G_a$.  The differential calculation in \Cref{CalculationOfLTTangentSpace} are meant to give us an upper bound on the dimensions of $H^1(\Gamma; \G_a)$ and $H^2(\Gamma; \G_a)$, but this family of differentials is zero in the additive case.  Accordingly, both of these vector spaces are infinite dimensional --- the infinitesimal
\end{remark}

\citeme{Neil's FG notes in the first half of section 18 talk about additive extensions and their relation to infinitesimal deformations.  In the second half, he (more or less) talks about the de Rham crystal and shows that $\Ext_{\mathrm{rigid}}(G, \G_a) \cong \operatorname{Prim}(H^1_{dR}(G/X))$ in 18.37.}
\todo{I still have some confusion about the formal similarity between deforming formal group laws over square-zero extensions of the base and deforming formal $n$--buds over the finite order nilpotent neighborhoods of a point.  This would be a good place to sort that out.}

Having accomplished all our major goals, we close our algebraic analysis of $\moduli{fg}$ with a diagram summarizing our results.
\begin{landscape}
\begin{figure}[b]
PICTURE GOES HERE.
\end{figure}
\end{landscape}








\section{Spectra detecting nilpotence}

We have now arrived at the conclusion of our program from \Cref{StructureOfMfgl} for manufacturing interesting homology theories from Quillen's theorem: we have an ample supply of open and closed substacks of $\moduli{fg}$, and we have analyzed its geometric points as well as their deformation neighborhoods.
\begin{definition}
We define the following ``chromatic'' homology theories:
\begin{itemize}
\item Recall that the moduli of $p$--typical group laws is affine, presented by the scheme $\Spec BPP_0$, $BPP_0 := \Z_{(p)}[v_1, v_2, \ldots, v_d, \ldots]$.  Since the inclusion of $p$--typical group laws into all group laws induces an equivalence of stacks, it follows that this formula determines a homology theory on finite spectra, called \textit{Brown--Peterson homology}: \[BPP_0(X) := MUP_0(X) \otimes_{MUP_0} BPP_0.\]
\item A chart for the open substack $\moduli{fg}^{\le d}$ in terms of $\moduli{fgl}^{\ptyp} \cong \Spec \Z_{(p)}[v_1, v_2, \ldots, v_d, \ldots]$ is $\Spec E(d)P_0 := \Spec \Z_{(p)}[v_1, v_2, \ldots, v_d^\pm]$.  It follows that there is a homology theory $E(d)P$, called \textit{the $d${\th} Johnson--Wilson homology}, defined on all spectra by \[E(d)P_0(X) := MUP_0(X) \otimes_{MUP_0} E(d)P_0.\]
\item Similarly, for a formal group $\Gamma$ of height $d < \infty$, there is a chart $\Spf \Z_p\ps{u_1, \ldots, u_{d-1}}$ for its deformation neighborhood.  Correspondingly, there is a homology theory $E_\Gamma{}$, called \textit{the (discontinuous) Morava $E$--theory for $\Gamma$}, determined by \[E_\Gamma{}_0(X) := MUP_0(X) \otimes_{MUP_0} \Z_p\ps{u_1, \ldots, u_{d-1}}.\] \todo{Why is this not written as $E_\Gamma P_0$?}
\item Since $(p, u_1, \ldots, u_{d-1})$ forms a regular sequence on $E_\Gamma{}_*$, we can form the regular quotient $K_\Gamma$ in the homotopy category.  This determines a spectrum, and hence determines a homology theory called \textit{the Morava $K$--theory for $\Gamma$}.  In the case where $\Gamma$ comes from the Honda $p$--typical formal group law (of height $d$), this spectrum is often written as $K(d)$.  As an edge case, we also set $K(\infty) = H\F_p$.\footnote{By \Cref{FGpsOverAlgClosedFields}, it often suffices to consider just these spectra to make statements about all $K_\Gamma$.  With more care, it even often suffices to consider formal groups $\Gamma$ of finite height.}
\item More delicately, there is a version of Morava $E$--theory which takes into account the formal topology on $(\moduli{fg})^\wedge_\Gamma$, called \textit{continuous Morava $E$--theory}.  It is defined by the pro-system $\{E_\Gamma(X) / u^I\}$, where $I$ ranges over multi-indices and the quotient is taken in the ``homotopical sense''\todo{Can you be more precise about this?}, i.e., $u_j$--torsion elements contribute to the odd-degree homotopy of the quotient.
\item There is also a homology theory associated to the closed substack $\moduli{fg}^{\ge d}$.  Since $I_d = (p, v_1, \ldots, v_{d-1})$ is generated by a regular sequence on $BPP_0$, we can directly define the spectrum $P(d)P$ by a regular quotient: \[P(d)P = BP / (p, v_1, \ldots, v_{d-1}).\]  This spectrum does have the property $P(d)P_0 = BPP_0 / I_d$, but it is \emph{only} the case that $P(d)P_0 = BPP_0(X) / I_d$ when $I_d$ forms a regular sequence on $BPP_0(X)$ --- which is reasonably rare among the cases of interest.
\end{itemize}
\end{definition}

\begin{remark}[{\cite[Section 5.2]{KLW}, \cite[Theorem 2.13]{StricklandProductsOnModules}}]\label{MoravaKIsNotCommutative}
\todo{Ravenel's Localization W/R/T, Corollaries 2.14 and 2.16, is another reference for this.  He, in turn, cites Yosimura's \textit{Universal coefficient sequences for cohomology theories of CW-spectra}.}
Morava $K$--theory at the even prime is not commutative.  Instead, there is a derivation $Q_d: K(d) \to \Susp K(d)$ satisfying \[ab - ba = u Q_d(a) Q_d(b).\]  In particular, $K(d)^* X$ is a commutative ring whenever $K(d)^1 X = 0$.
\end{remark}

Having constructed these ``stalk'' homology theories, I want to show that you can actually perform stalkwise analyses of the sheaves coming from bordism theory.  Our example case is a famous theorem: the solution of Ravenel's nilpotence conjectures by Devinatz, Hopkins, and Smith.  Their theorem concerns spectra which ``detect nilpotence'' in the following sense:

\todo[inline]{All the stuff after this point is written graded-ly.  I guess we still haven't decided whether this is the right presentation.}

\begin{definition}\citeme{Hopkins--Smith, or maybe the intro to D--H--S}
A ring spectrum $E$ \textit{detects nilpotence} if, for any ring spectrum $R$, the kernel of the Hurewicz homomorphism $E_*: \pi_* R \to E_* R$ consists of nilpotent elements.
\end{definition}

First, a word about why one would care about such a condition.  The following theorem is classical:
\begin{theorem}[Nishida]\citeme{Nishida}
Every homotopy class $\alpha \in \pi_{\ge 1} \S$ is nilpotent. \qed
\end{theorem}

\noindent However, people studying $K$--theory in the '$70$s discovered the following phenomenon:

\begin{theorem}[Adams]\citeme{Adams}
Let $M_{2n}(p)$ denote the mod--$p$ Moore spectrum with bottom cell in degree $2n$.  Then there is an index $n$ and a map $v: M_{2n}(p) \to M_0(p)$ such that $KU_* v$ acts by multiplication by the $n$\textsuperscript{th}\, power of the Bott class.  The minimal such $n$ is given by the formula \[n = \begin{cases} p-1 & \text{when $p \ge 3$}, \\ 4 & \text{when $p = 2$}. \qed \end{cases}\]
\end{theorem}

\noindent In particular, this means that $v$ cannot be nilpotent, since a null-homotopic map induces the zero map in any homology theory.  Just as we took the non-nilpotent endomorphism $p$ in $\pi_0 \End \S$ and coned it off, we can take the endomorphism $v$ in $\pi_{2p-2} \End M_0(p)$ and cone it off to form a new spectrum called $V(1)$.\footnote{The spectrum $V(1)$ is actually defined to be a finite spectrum with $BP_* V(1) \cong BP_* / (p, v_1)$. At $p = 2$ this spectrum doesn't exist and this is a misnomer.  More generally, at odd primes $p$ Nave shows that $V((p+1)/2)$ doesn't exist~\cite[Theorem 1.3]{Nave}.}

One can ask, then, whether the pattern continues: does $V(1)$ have a non-nilpotent self-map, and can we cone it off to form a new such spectrum with a new such map?  Can we then do that again, indefinitely?  In order to study this question, we are motivated to find spectra $E$ as above, since an $E$ that detects nilpotence cannot send such a nontrivial self-map to zero.  In fact, we found one such $E$ already:

\begin{theorem}[Devinatz--Hopkins--Smith]\label{DevinatzHopkinsSmith}\citeme{Devinatz, Hopkins, Smith}
Complex cobordism $MU$ detects nilpotence. \qed
\end{theorem}

They also show that the $MU$ is the universal object which detects nilpotence, in the sense that any other ring spectrum can have this property checked stalkwise on $\context{MU}$:

\begin{corollary}[{\cite[Theorem 3]{HopkinsSmith}}]\label{LocalNilpotenceDetection}
A ring spectrum $E$ detects nilpotence if and only if for all $0 \le d \le \infty$ and for all primes $p$, $K(d)_* E \ne 0$.
\end{corollary}
\begin{proof}
If $K(d)_* E = 0$ for some $d$, then the non-nilpotent unit map $\S \to K(d)$ lies in the kernel of the Hurewicz homomorphism for $E$, so $E$ fails to detect nilpotence.

Hence, for any $d$ we must have $K(d)_* E \ne 0$.  Because $K(d)_*$ is a field, it follows by picking a basis of $K(d)_* E$ that $K(d) \sm E$ is a nonempty wedge of suspensions of $K(d)$.  So, for $\alpha \in \pi_* R$, if $E_* \alpha = 0$ then $(K(d) \sm E)_* \alpha = 0$ and hence $K(d)_* \alpha = 0$.  So, we need to show that if $K(d)_* \alpha = 0$ for all $n$ and all $p$ then $\alpha$ is nilpotent.  Taking \Cref{DevinatzHopkinsSmith} as given, it would suffice to show merely that $MU_* \alpha$ is nilpotent.  This is equivalent to showing that the ring spectrum $MU \sm R[\alpha^{-1}]$ is contractible or that the unit map is null: \[\S \to MU \sm R[\alpha^{-1}].\]

A nontrivial result of Johnson and Wilson shows that if $MU_* X = 0$ for any $X$, then for any $d$ we have $K([0, d])_* X = 0$ and $P(d+1)_* X = 0$.  (Specifically, it is immediate that $MU_* X = 0$ forces $P(d+1)_* X = 0$ and $v_{d'}^{-1} P(d')_*(X) = 0$ for all $d' < d$.  What's nontrivial is showing that $v_{d'}^{-1} P(d')_*(X) = 0$ if and only if $K(d')_*(X) = 0$~\cite[Theorem 2.1.a]{RavenelLocalizationWRTPeriodic},~\cite[Section 3]{JohnsonWilson}.)  Taking $X = R[\alpha^{-1}]$, we have assumed all of these are zero except for $P(d+1)$.  But $\colim_d P(d+1) \simeq H\F_p \simeq K(\infty)$, and $\S \to K(\infty) \sm R[\alpha^{-1}]$ is assumed to be null as well.  By compactness of $\S$, that null-homotopy factors through some finite stage $P(d+1) \sm R[\alpha^{-1}]$ with $d \gg 0$.
\end{proof}

As another example of the primacy of these methods, we can show the following interesting result.  Say that $R$ is a field spectrum when every $R$--module (in the homotopy category) splits as a wedge of suspensions of $R$.  It is easy to check (as mentioned in the proof above) that $K(d)$ is an example of such a spectrum.

\begin{corollary}\label{FieldSpectraAreKTheories}
Every field spectrum $R$ splits as a wedge of Morava's $K(d)$ theories.
\end{corollary}
\begin{proof}
Set $E = \bigvee_{\text{primes $p$}} \bigvee_{d \in [0, \infty]} K(d)$, so that $E$ detects nilpotence.  The class $1$ in the field spectrum $R$ is non-nilpotent, so it survives when paired with some $K$--theory $K(d)$, and hence $R \sm K(d)$ is not contractible.  Because both $R$ and $K(d)$ are field spectra, the smash product of the two simultaneously decomposes into a wedge of $K(d)$s and a wedge of $R$s.  So, $R$ is a retract of a wedge of $K(d)$s, and picking a basis for its image on homotopy shows that it is a sub-wedge of $K(d)$s.
\end{proof}

\begin{remark}
This is interesting in its own right, because field spectra are exactly those spectra which have K\"unneth isomorphisms.  So, even if you weren't neck-deep in algebraic geometry, you might still have struck across these homology theories just if you like to compute things, since K\"unneth formulas make things computable.
\end{remark}

\todo{Jake asked if there was a geometric interpretation of these cohomology theories $K_\Gamma$.  At present, there isn't one.  Maybe remark on this.}






\section{Periodicity in finite spectra}

We're now well-situated to address Ravenel's question about finite spectra and periodic self-maps.  The solution to this problem passes through some now-standard machinery for triangulated $\otimes$--categories.

\begin{definition}
A subcategory of the category of a triangulated category (e.g., $p$--local finite spectra) is \textit{thick} if\ldots\todo{Do triangulated categories come with weak equivalences?} \todo{Lurie's definition (lecture 26) doesn't talk about weak equivalences.}
\begin{itemize}
\item \ldots it is closed under weak equivalences.
\item \ldots it is closed under retracts.
\item \ldots it has a $2$-out-of-$3$ property for cofiber sequences.
\end{itemize}
\end{definition}

\noindent Examples of thick subcategories include:
\begin{itemize}
\item The category $\CatOf{C}_d$ of $p$--local finite spectra which are $K(d-1)$--acyclic.  (For instance, if $d = 1$, the condition of $K(0)$--acyclicity is that the spectrum have purely torsion homotopy groups.)  These are called ``finite spectra of type at least $d$''.
\item The category $\CatOf{D}_d$ of $p$--local finite spectra $F$ which have a self-map $v: \Susp^N F \to F$, $N \gg 0$, inducing multiplication by a unit in $K(d)$--homology.  These are called ``$v_d$--self--maps''.
\end{itemize}

Ravenel shows the following useful result interrelating the $\CatOf C_d$:
\begin{lemma}[{\cite[Theorem 2.11]{RavenelLocalizationWRTPeriodic}}]\label{CdCategoriesNest}
For $X$ a finite complex, there is a bound \[\dim K(d-2)_* X \le \dim K(d-1)_* X.\]  In particular, there is an inclusion $\CatOf C_{d-1} \subseteq \CatOf C_d$. \qed
\end{lemma}

Hopkins and Smith show the following classification theorem:

\begin{theorem}[{\cite[Theorem 7]{HopkinsSmith}}]
Any thick subcategory $\CatOf C$ of $p$--local finite spectra must be $\CatOf C_d$ for some finite $d$.
\end{theorem}
\begin{proof}
Since $\CatOf C_d$ are nested by \Cref{CdCategoriesNest} and they form an exhaustive filtration\todo{Why do you not need $\CatOf C_\infty$ for this?}, it is thus sufficient to show that any object $X \in \CatOf C$ with $X \in \CatOf C_d$ induces an inclusion $\CatOf C_d \subseteq \CatOf C$.  Write $R$ for the endomorphism ring spectrum $R = F(X, X)$, and write $F$ for the fiber of its unit map: \[F \xrightarrow{f} \S \xrightarrow{\eta_R} R.\]  Finally, let $Y$ be \emph{any} finite spectrum of type at least $d$.

Now consider applying $K(n)$--homology (for \emph{arbitrary} $n$) to the map \[1 \sm f\co Y \sm F \to Y \sm \S.\]  The induced map is always zero:
\begin{itemize}
\item In the case that $K(n)_* X$ is nonzero, then $K(n)_* \eta_R$ is injective\todo{Recall, $K(n)_* \mathbb{S}$ has rank 1.} and $K(n)_* f$ is zero.
\item In the case that $K(n)_* X$ is zero, then $n \le d$\todo{In class you eventually decided on $n < d$.} and, because of the bound on type, $K(n)_* Y$ is zero as well.\todo{Do we need $X$ to be exactly of type $d$ to make this conclusion?}
\end{itemize}
By a small variant of local nilpotence detection (\Cref{LocalNilpotenceDetection}, \cite[Corollary 2.5]{HopkinsSmith}), it follows for $j \gg 0$ that \[Y \sm F^{\sm j} \xrightarrow{1 \sm f^{\sm j}} Y \sm \S^{\sm j}\] is null-homotopic.  Hence, one can calculate the cofiber to be \[\operatorname{cofib}\left( Y \sm F^{\sm j} \xrightarrow{1 \sm f^{\sm j}} Y \sm \S^{\sm j} \right) \simeq Y \sm \operatorname{cofib} f^{\sm j} \simeq Y \vee (Y \sm \Susp F^{\sm j}),\] so that $Y$ is a retract of this cofiber.

We now work to show that this smash product lies in the thick subcategory $\CatOf C$ of interest.  First, note that $X \sm Z$ lies in $\CatOf C$ for any finite complex $Z$, since $Z$ can be expressed as a finite gluing diagram of spheres and smashing this through with $X$ expresses $X \sm Z$ as the iterated cofiber of maps with source and target in $\CatOf C$.  Next, consider the following smash version of the octahedral axiom: the factorization \[F \sm F^{\sm (j-1)} \xrightarrow{f \sm 1} \S \sm F^{\sm (j-1)} \xrightarrow{1 \sm f^{\sm (j-1)}} \S \sm \S^{\sm (j-1)}\] begets a cofiber sequence\todo{Is this sequence backwards? (Note that it doesn't matter: you can just write the factorization in the other order...)} \[F \sm \operatorname{cofib} f^{\sm (j-1)} \to \operatorname{cofib} f^{\sm j} \to \operatorname{cofib} f \sm \S^{\sm (j-1)}.\]

Now turn an eye toward induction.  Noting that $\operatorname{cofib}(f) = R = X \sm DX$ \todo{Recall, $f$ is the fiber of the $\eta_R$.} lies in $\CatOf C$, we can use the $2$-out-of-$3$ property on the octahedral sequence to see that $\operatorname{cofib}(f^{\sm j})$ lies in $\CatOf C$.  It follows that $Y \sm \operatorname{cofib}(f^{\sm j})$ also lies in $\CatOf C$, and using the retraction $Y$ belongs to $\CatOf C$ as well.
\end{proof}

As an application of this classification, they also show the following considerably harder theorem:

\begin{theorem}[{\cite[Theorem 9]{HopkinsSmith}}]
A $p$--local finite spectrum is $K(d-1)$--acyclic exactly when it admits a $v_d$--self--map.\todo{It's also a corollary of these same methods that the inclusion $\CatOf C_d \subsetneq \CatOf C_{d-1}$ is proper.}
\end{theorem}
\begin{proof}[Executive summary of proof]
Given the classification of thick subcategories, if a property is closed under thickness then one need only exhibit a single spectrum with the property to know that all the spectra in the thick subcategory it generates also all have that property.  Inductively, they manually construct finite spectra $M_0(p^{i_0}, v_1^{i_1}, \ldots, v_{d-1}^{i_{d-1}})$ for sufficiently large indices $i_*$ which admit a self-map $v$ governed by a commuting square
\begin{center}
\begin{tikzcd}
BP_* M_{|v_d| i_d}(p^{i_0}, v_1^{i_1}, \ldots, v_{d-1}^{i_{d-1}}) \arrow{r}{v} \arrow[equal]{d} & BP_* M_0(p^{i_0}, v_1^{i_1}, \ldots, v_{d-1}^{i_{d-1}}) \arrow[equal]{d} \\
\Susp^{|v_d| i_d} BP_* / (p^{i_0}, v_1^{i_1}, \ldots, v_{d-1}^{i_{d-1}}) \arrow{r}{- \cdot v_d^{i_d}} & BP_* / (p^{i_0}, v_1^{i_1}, \ldots, v_{d-1}^{i_{d-1}}).
\end{tikzcd}
\end{center} \todo{You wrote $BPP_0$ yesterday.}
These maps are guaranteed by very careful study of Adams spectral sequences.
\end{proof}

\begin{remark}
We ran into the asymptotic condition $I \gg 0$ yesterday, when we asserted that there is no root of the $2$--local $v_1$--self--map $v\co M_8(2) \to M_0(2)$.
\end{remark}

There is a second interesting application of these ideas, investigated by Paul Balmer as part of a broad attempt to analyze a geometric object through its modules.

\begin{definition}\citeme{Reference Balmer's SSS paper throughout this tail}
Given a triangulated $\otimes$--category $\CatOf C$, define a thick subcategory $\CatOf C' \subseteq \CatOf C$ to be\ldots
\begin{itemize}
\item \ldots a \textit{$\otimes$--ideal} when it has the additional property that $x \in \CatOf C'$ forces $x \otimes y \in \CatOf C'$ for any $y \in \CatOf C$.
\item \ldots a \textit{prime $\otimes$--ideal} when $x \otimes y \in \CatOf C'$ also forces at least one of $x \in \CatOf C'$ or $y \in \CatOf C'$.
\end{itemize}
Finally, define the \textit{spectrum} of $\CatOf C$ to be its collection of prime $\otimes$--ideals, topologized so that $U(x) = \{\CatOf C' \mid x \in \CatOf C'\}$ form a basis of opens.\todo{Double check that you have the directionality of this right.  Is $U$ a basic open or a basic closed?  It it full of things that contain $x$ or that don't contain in $x$?}
\end{definition}

\begin{theorem}[Balmer]
The spectrum of $D^{\perf}(\CatOf{Mod}_R)$ is naturally homeomorphic to the Zariski spectrum of $R$. \qed
\end{theorem}

Balmer's construction applies much more generally.  The category $\CatOf{Spectra}$ can be identified with $\CatOf{Modules}_{\S}$, and so one is moved to attempt to compute the Balmer spectrum of $\CatOf{Modules}_{\S}^{\perf} = \CatOf{Spectra}^{\mathrm{fin}}$.  In fact, we just finished this.
\begin{theorem}
The Balmer spectrum of $\CatOf{Spectra}_{(p)}^{\mathrm{fin}}$ consists of the thick subcategories $\CatOf C_d$, and $\{\CatOf C_n\}_{n=0}^d$ are its open sets.
\end{theorem}
\begin{proof}
Using the characterization of $\CatOf C_d$ as the kernel of $K(d-1)_*$, we see that it is a prime $\otimes$--ideal: \[K(d-1)_*(X \sm Y) \cong K(d-1)_* X \otimes_{K(d-1)_*} K(d-1)_* Y\] is zero exactly when at least one of $X$ and $Y$ is $K(d-1)$--acyclic.
\end{proof}

\begin{remark}
In fact, our favorite functor $\context{MU}(-)\co \CatOf{Spectra} \to \CatOf{QCoh}(\context{MU})$ induces a homeomorphism of the Balmer spectrum of $\CatOf{Spectra}^{\mathrm{fin}}$ to that of $\moduli{fg}$\todo{Be careful about what the latter half of this means.  Do you mean again to form something like $D^{\perf}(\moduli{fg})$?}.  However, this functor does \emph{not} exist on the level triangulated categories, so this remark has to be interpreted somewhat lightly.
\end{remark}





\section{Chromatic localization}\label{ChromaticLocalizationSection}

Balmer's construction is remarkably successful at describing the most salient features of the stable category, but it falls a ways short of the rich ``spectrum'' object we've come to know from algebraic geometry.  In particular, we have only a topological space, and not anything like a locally ringed space (or a space otherwise equipped locally with algebraic data).  It's also totally unclear why $MU$ plays such an important mediating role between geometry (i.e., the stable category) and algebra (i.e., the moduli of formal groups).
%\footnote{We will address this in our situation, but in general this is an open question: given a ring spectrum $R$, how can one recognize these local categories of spectra in terms of $R$, without reference to auxiliary spectra like $MU$?  Or, just as importantly: what makes $MU$ a special $\S$--algebra?}
Nonetheless, taking that as granted, we can use Bousfield's theory of homological localization to access ``local'' categories of spectra of the sort that a sheaf of local rings would supply us with.\todo{Is this just motivation or is there something specific you can say relating the following to Balmer spectra?}

\begin{theorem}[{\cite{Bousfield}, \cite[Theorem 7.7]{Margolis}}]
Let $R_*$ denote the homology theory associated by Landweber's \Cref{LandwebersStackyTheorem} to a flat map $j\co \Spec R \to \moduli{fg}$.  There is then a diagram
\begin{center}
\begin{tikzcd}[column sep=2.2cm,row sep=2cm]
\CatOf{Spectra}_R \arrow["R_*", "\mathrm{conservative}"', red]{r} \arrow[leftarrow, shift left=0.20cm, red]{d}{L_R} & \CatOf{QCoh}(\Spec R) \arrow[shift left=0.20cm, red, leftarrow]{d}{j^*} \\
\CatOf{Spectra} \arrow[leftarrow,shift left=0.20cm, "\dashv"']{u}{i} \arrow[red]{ru}{R_*} \arrow[red]{r}{MU_*} & \CatOf{QCoh}(\context{MU}), \arrow[leftarrow, shift left=0.20cm, "\dashv"']{u}{j_*}
\end{tikzcd}
\end{center}
such that $i$ is fully faithful, $i$ is left-adjoint to $L_R$, $j^*$ is left-adjoint to $j_*$, $i$ and $j_*$ are inclusions of full subcategories, the red composites are all equal, and $R_*$ is conservative on $\CatOf{Spectra}_R$.\footnote{The meat of this theorem is in overcoming set-theoretic difficulties in the construction of $\CatOf{Spectra}_R$.  Bousfield accomplished this by describing a model structure on $\CatOf{Spectra}$ for which $R$--equivalences create the weak--equivalences.} \qed
\end{theorem}

\todo{Jay was rightfully fussy about the difference between, e.g., the open submoduli and its affine cover.  Write this more carefully.}
In the case when $R$ models the inclusion of the deformation space around the point $\Gamma_d$, we will denote the localizer by \[\CatOf{Spectra} \xrightarrow{\widehat L_d} \CatOf{Spectra}_{\Gamma_d}.\]  In the case when $R$ models the inclusion of the open complement of the unique closed substack of codimension $d$, we will denote the localizer by \[\CatOf{Spectra} \xrightarrow{L_d} \CatOf{Spectra}_d = \CatOf{Spectra}_{\moduli{fg}^{\le d}}.\]  We have set up our situation so that the following properties of these localizations either have easy proofs or are intuitive from the algebraic analogue of $j^* \vdash j_*$:
\begin{enumerate}
\item There is an equivalence \[L_d X \simeq (L_d \S) \sm X,\] analogous to $j^* M \simeq R \otimes M$ in the algebraic setting~\cite[Theorem 7.5.6]{RavenelOrangeBook}.  Because $\widehat L_d$ is associated to the inclusion of a formal scheme (i.e., an ind-finite scheme), it has the formula \[\widehat L_d X \simeq \lim_I \left( M_0(v^I) \sm L_d X \right)\] analogous to $j^* M \simeq \lim_j (R/I^j \otimes M)$ in the complete algebraic setting~\cite[Proof of Lemma 2.3]{HoveyCSC}.\citeme{Ravenel (and Hopkins)}\todo{Also mention that there are results about thinking of this thing as a pro-spectrum rather than a spectrum?  For instance, there's the Davis--Lawson result on $\{M_0(v^I)\}$ forming an $E_\infty$--ring in the pro-category.}
\item Because the open substack of dimension $d$ properly contains both the open substack of dimension $(d-1)$ and the infinitesimal deformation neighborhood of the closed point of height $d$, there are natural factorizations
\begin{align*}
\operatorname{id} \to L_d \to L_{d-1}, & & \operatorname{id} \to L_d \to \widehat L_d.
\end{align*}
In particular, $L_d X = 0$ implies both $L_{d-1} X = 0$ and $\widehat L_d X = 0$.\todo{Also, idempotence?}
\item The inclusion of the open substack of dimension $d-1$ into the one of dimension $d$ has relatively closed complement the point of height $d$.  Algebraically, this gives a gluing square (or Mayer-Vietoris square), and this is reflected in homotopy theory by a homotopy pullback square (or chromatic fracture square): \todo{This deserves a proof or a reference. (I spent a moment looking, and I can't actually find a nice ``old'' reference for chromatic fracture squares in the literature...)}
\begin{center}
\begin{tikzcd}
L_d \arrow{r} \arrow{d} \arrow[dr, phantom, "\lrcorner", very near start] & \widehat L_d \arrow{d} \\
L_{d-1} \arrow{r} & L_{d-1} \widehat L_d.
\end{tikzcd}
\end{center}
\end{enumerate}

\begin{remark}
More generally, whenever $L_B L_A = 0$, there is a fracture square
\begin{center}
\begin{tikzcd}
L_{A \vee B} \arrow{r} \arrow{d} \arrow[dr, phantom, "\lrcorner", very near start] & L_B \arrow{d} \\
L_A \arrow{r} & L_A L_B.
\end{tikzcd}
\end{center}
So, this last fact follows from $L_d \simeq L_{K(0) \vee \cdots \vee K(d)}$ and $L_{K(d)} L_{K(d-1)} = 0$.  Similarly, there is an ``arithmetic fracture square''
\begin{center}
\begin{tikzcd}
X \arrow{r} \arrow{d} \arrow[dr, phantom, "\lrcorner", very near start] & \prod_p X^\wedge_p \arrow{d} \\
X_{\Q} \arrow{r} & \left( \prod_p X^\wedge_p \right)_{\Q},
\end{tikzcd}
\end{center}
which is a topological instantiation of the ad\`elic decomposition of a $\Z$--module.
\end{remark}

There are also considerably more complicated facts known about these functors:
\begin{theorem}[{\cite[Theorem 7.5.7]{RavenelOrangeBook}}]
The homotopy limit of the tower \[\cdots \to L_d F \to L_{d-1} F \to \cdots \to L_1 F \to L_0 F\] recovers the $p$--local homotopy type of any finite spectrum $F$.\footnote{Spectra satisfying this limit property are said to be \textit{chromatically complete}, which is closely related to being \textit{harmonic}, i.e., being local with respect to $\bigvee_{d=0}^\infty K(d)$.  (I believe this a joke about ``music of the spheres''.)  It is known that nice Thom spectra are harmonic (so, in particular, every suspension and finite spectrum), that every finite spectrum is chromatically complete, and that there exist some harmonic spectra which are not chromatically complete.}
\end{theorem}

\noindent This suggests a productive method for analyzing the homotopy groups of spheres: study the homotopy groups of each $L_d \S$ and perform the reassembly process encoded by this inverse limit.  Writing $M_d$ for the fiber in the sequence \[M_d \to L_d \to L_{d-1},\] the ``geometric chromatic spectral sequence'' associated to this tower takes the form \[\pi_* M_* \S \Rightarrow \pi_* \S_{(p)}.\]  So, $M_d$ means the difference between the assembled layers $L_d$ and $L_{d-1}$ --- but this was also the heuristic job of $\widehat L_d$ above.  It turns out that these are interrelated by the following two theorems:
\begin{theorem}\citeme{Gross--Hopkins?}
There is a pair of natural equivalences
\begin{align*}
\widehat L_d M_d & \simeq \widehat L_d, &
M_d \widehat L_d & \simeq M_d.
\qed
\end{align*}
\end{theorem}

\begin{theorem}\citeme{I forget who this is due to}
\todo{Referring to ``1.'' is clumsy.  Make the previous things into Lemmas or something, rather than a bulleted list.}
Analogous to ``1.'' above, there is a natural equivalence \[M_d X \simeq \colim_I \left( M^0(v^I) \sm L_d X \right),\] where $M^0(v^I)$ denotes a generalized Moore spectrum with \emph{top} cell in dimension $0$.
\end{theorem}

\begin{remark}
It is possible to draw the chromatic fracture square and the definition of $M_d$ in the same diagram:
\begin{center}
\begin{tikzcd}
M_d X \arrow{d} \arrow[equal]{r} & M_d X \arrow{d} \\
L_d X \arrow{r} \arrow{d} \arrow[dr, phantom, "\lrcorner", very near start] & \widehat L_d X \arrow{d} \\
L_{d-1} X \arrow{r} & L_{d-1} \widehat L_d X.
\end{tikzcd}
\end{center}
From this, we see that there is a fiber sequence \[M_d X \to \widehat L_d X \to L_{d-1} \widehat L_d X.\]  The case $d = 1$ gives the prototypical example of the difference between these two presentations of the ``exact height $d$ data'', where the sequence becomes: \[\colim_j (M^0(p^j) \sm L_1 X) \to \lim_j (M_0(p^j) \sm L_1 X) \to \left( \lim_j (M_0(p^j) \sm L_1 X) \right)_{\Q}.\]  If, for instance, $\pi_0 L_1 X = \Z_{(p)}$, then the long exact sequence of homotopy groups associated to this fiber sequence gives
\begin{center}
\begin{tikzcd}
\pi_0 \widehat L_1 X \arrow{r} \arrow[equal]{d} & \pi_0 L_0 \widehat L_1 X \arrow{r} \arrow[equal]{d} & \pi_{-1} M_1 X \arrow[equal]{d} \\
\Z^\wedge_p \arrow{r} & \Q_p \arrow{r} & \Z/p^\infty.
\end{tikzcd}
\end{center}
This is a model for what happens generally: the $v_j$--torsion--free groups get converted to infinitely $v_j$--divisible groups, with some dimension shifts.  (\emph{Exactly} what happens is often hard to work out, and I'm not aware of a totally general statement.)
\end{remark}

In any case, one sees that it is also profitable to consider the homotopy groups of $\widehat L_d \S$.  The spectral version $\sheaf D_{\S \to E}(F)$ of $\context{E}(F)$ considered on the first day furnishes us with a tool by which we can approach this:

\begin{theorem}[{\Cref{Pi2AndInvariantDiffls}, \Cref{DefnOfNilpCompletionAndASS}, and \Cref{FHGivesComodules}}]
The $E_\Gamma$--based Adams spectral sequence for the sphere converges strongly to $\pi_* \widehat L_d \S$.  Writing $\omega$ for the line bundle on $\context{E_\Gamma}$ of invariant differentials, we have \[E_2^{*, *} = H^*_{\mathrm{stack}}(\context{E_\Gamma}; \omega^{\otimes *}) \Rightarrow \pi_* \widehat L_d \S. \qed\]
\end{theorem}

\todo{Show that the action of the stabilizer group lifts to an action on Lubin--Tate space.  This is relevant for what you're about to write.}

The utility of this theorem is in the identification with stack cohomology.  Recalling the discussion in \Cref{HopfAlgebrasFromFiniteGroups,HF2HomologyIsValuedInAutGaEquivarModules}, as well as the identification \[\context{E_{\Gamma_d}} = \left( \moduli{fg} \right)^\wedge_{\Gamma_d} \simeq \widehat{\mathbb A}^{d-1}_{\mathbb W(k)} \mmod \InternalAut(\Gamma_d)\] in \Cref{ActionBySnLiftsToLTn}, we become interested in the action of $\Aut \Gamma_d$ on $LT_d$.  We will deduce the following description of $\Aut \Gamma_d$ later on:
\begin{theorem}[{\Cref{FormOfStabilizerGroup}}]
For $\Gamma_d$ the Honda formal group law of height $d$ over a perfect field $k$ of positive characteristic $p$, we compute \[\Aut \Gamma_d \cong \left. \W_p(k) \<S\> \middle/ \left( \begin{array}{c} Sw = w^\phi S, \\ S^d = p \end{array} \right) \right.,\] where $\phi$ denotes a lift of the Frobenius from $k$ to $\W_p(k)$. \qed
\end{theorem}
\noindent As a matter of emphasis, this Theorem does not give a description of the \emph{representation} of $\Aut \Gamma_d$, which is very complicated.  Nonetheless, we have reduced the computation of all of the stable homotopy groups of spheres to an arithmetically--founded problem in profinite group cohomology, so that arithmetic geometry might lend a hand.

\begin{example}[Adams]
In the case $d = 1$, $\operatorname{Aut}(\Gamma_1) = \Z_p^\times$ and it acts on $\pi_* E_1 = \Z_p[u^\pm]$ by $\gamma \cdot u^n \mapsto \gamma^n u^n$.  At odd primes $p$ (so that $p$ is coprime to the torsion part of $\Z_p^\times$), one computes \[H^s(\operatorname{Aut}(\Gamma_1); \pi_* E_1) = \begin{cases}\Z_p & \text{when $s = 0$}, \\ \bigoplus_{j = 2(p-1)k} \Z_p\{u^j\} / (pk u^j) & \text{when $s = 1$}, \\ 0 & \text{otherwise}. \end{cases}\]  This, in turn, gives the calculation \[\pi_t \widehat L_1 \S^0 = \begin{cases} \Z_p & \text{when $t = 0$}, \\ \Z_p / (pk) & \text{when $t = t|v_1| - 1$}, \\ 0 & \text{otherwise}. \end{cases}\]  These groups are familiar to homotopy theorists: the $J$--homomorphism $J: BU \to BF$\todo{I don't remember what $F$ is.} described on the first day selects exactly these elements (for nonnegative $t$).  \todo[inline]{It is a good exercise to work out what this calculation means in terms of the rest of the fracture square and for $M_1 \S$.}
\end{example}








